/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/m/FlexBox","sap/viz/ui5/controls/VizFrame","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/f/cards/Data","sap/base/Log"],function(e,t,i,a,r,n,s,o,l,u){"use strict";var d={Top:"top",Bottom:"bottom",Left:"left",Right:"right"};var p={TopLeft:"topLeft",Center:"center"};var v={Left:"left",Center:"center",Right:"right"};var f={Line:"line",StackedColumn:"stacked_column",StackedBar:"stacked_bar",Donut:"donut"};var c=e.extend("sap.f.cards.AnalyticalContent",{metadata:{properties:{configuration:{type:"object"}},aggregations:{_content:{multiple:false,visibility:"hidden"}}},constructor:function(t,i){if(typeof t!=="string"){i=t}if(i&&i.serviceManager){this._oServiceManager=i.serviceManager;delete i.serviceManager}e.apply(this,arguments)},renderer:function(e,t){e.write("<div");e.writeElementData(t);e.addClass("sapFCardContentAnalytical");e.writeClasses();e.write(">");e.renderControl(t.getAggregation("_content"));e.write("</div>")}});c.prototype.init=function(){var e=new t;this.setModel(e)};c.prototype.setConfiguration=function(e){this.setProperty("configuration",e);if(!e){return this}this._setChart(e);return this};c.prototype._getVizPropertiesObject=function(e){var t=e.title,i=e.legend,a=e.plotArea;if(!e){return this}var r={title:{style:{fontWeight:"normal"},layout:{respectPlotPosition:false}},legend:{},legendGroup:{layout:{}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"}},categoryAxis:{title:{}},valueAxis:{title:{}}};if(t){r.title.text=t.text;r.title.visible=t.visible;r.title.alignment=v[t.alignment]}if(i){r.legend.visible=i.visible;r.legendGroup.layout.position=d[i.position];r.legendGroup.layout.alignment=p[i.alignment]}if(a){if(a.dataLabel){r.plotArea.dataLabel=a.dataLabel}if(a.categoryAxisText){r.categoryAxis.title.visible=a.categoryAxisText.visible}if(a.valueAxisText){r.valueAxis.title.visible=a.valueAxisText.visible}}return r};c.prototype._setChart=function(e){var t;if(!e){return}if(e.data){t=e.data.request}if(e.data.json&&!t){this._updateModel(e.data.json,e.data.path,e)}if(t){l.fetch(t).then(function(t){this._updateModel(t,e.data.path,e);this.fireEvent("_updated")}.bind(this)).catch(function(e){})}};c.prototype._updateModel=function(e,t,i){var a=i.chartType;if(!a){u.error("ChartType is a mandatory property");return}this.getModel().setData(e);var r=this._createChart(i,t);this.setAggregation("_content",r)};c.prototype._createChart=function(e,t){var i=[];if(e.dimensions){var s=[];for(var o=0;o<e.dimensions.length;o++){var l=e.dimensions[o];var u=l.value.substring(1,l.value.length-1);i.push(u);var d={name:u,value:l.value};s.push(d)}}var p=[];if(e.measures){var v=[];for(var o=0;o<e.measures.length;o++){var c=e.measures[o];var u=c.value.substring(1,c.value.length-1);p.push(u);var g={name:u,value:c.value};v.push(g)}}var h=new n({measures:v,dimensions:s,data:{path:t||"/"}});var m=new a({uiConfig:{applicationSet:"fiori"},height:"100%",width:"100%",vizType:f[e.chartType],dataset:h,legendVisible:e.legend,feeds:[new r({uid:e.measureAxis,type:"Measure",values:p}),new r({uid:e.dimensionAxis,type:"Dimension",values:i})]});var y=this._getVizPropertiesObject(e);m.setVizProperties(y);return m};return c});