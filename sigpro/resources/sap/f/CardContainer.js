/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/core/delegate/ItemNavigation","sap/f/CardContainerRenderer","sap/ui/Device","sap/ui/layout/cssgrid/VirtualGrid"],function(e,t,i,s,r,n,a){"use strict";var o=5*16;var h=16;var g=16;function p(e){var t=e.getLayoutData();return t?t.getColumns():1}function l(){return!n.browser.msie&&!(n.browser.edge&&n.browser.version<g)}var d=e.extend("sap.f.CardContainer",{metadata:{library:"sap.f",properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:""},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:""}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Control",multiple:true,singularName:"item"}}}});d.prototype._onBeforeItemRendering=function(){var e=this.getParent(),t=e._resizeListeners[this.getId()];if(t){i.deregister(t)}delete e._resizeListeners[this.getId()]};d.prototype._onAfterItemRendering=function(){var e=this.getParent(),t=p(this);if(l()){this.$().parent().css({"grid-column":"span "+t})}else{var s=t*o+(t-1)*h;this.$().css({top:0,left:0,width:s,position:"absolute"})}e._resizeListeners[this.getId()]=i.register(this.getDomRef(),e._resizeHandler);e._setItemNavigationItems();e._applyLayout()};d.prototype._onItemChange=function(e){if(e.name!=="items"||!e.child){return}if(e.mutation==="insert"){e.child.addEventDelegate(this._itemDelegate,e.child)}else if(e.mutation==="remove"){e.child.removeEventDelegate(this._itemDelegate,e.child)}};d.prototype._deregisterResizeListeners=function(){var e,t;for(e in this._resizeListeners){t=this._resizeListeners[e];i.deregister(t)}delete this._resizeListeners};d.prototype._setItemNavigationItems=function(){if(!this._isRenderingFinished){return}};d.prototype.init=function(){this._resizeListeners={};this._itemDelegate={onBeforeRendering:this._onBeforeItemRendering,onAfterRendering:this._onAfterItemRendering};this._itemsObserver=new t(this._onItemChange.bind(this));this._itemsObserver.observe(this,{aggregations:["items"]});this._resizeHandler=this._resize.bind(this);this._itemNavigation=(new s).setCycling(false);this._itemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"]});this.addDelegate(this._itemNavigation)};d.prototype.onBeforeRendering=function(){var e=this._resizeListeners[this.getId()];if(e){i.deregister(e)}this._isRenderingFinished=false};d.prototype.onAfterRendering=function(){this._resizeListeners[this.getId()]=i.register(this.getDomRef(),this._resizeHandler);this._isRenderingFinished=true;this._setItemNavigationItems();this._applyLayout()};d.prototype.exit=function(){this._deregisterResizeListeners();if(this._itemsObserver){this._itemsObserver.disconnect();delete this._itemsObserver}if(this._itemNavigation){this.removeDelegate(this._itemNavigation);this._itemNavigation.destroy();delete this._itemNavigation}};d.prototype._resize=function(){this._applyLayout()};d.prototype._applyLayout=function(){if(!this._isRenderingFinished){return}if(l()){this.$().children().each(function(){var e=jQuery(this);var t=jQuery(e.children()[0]).outerHeight();e.css({"grid-row":"span "+(Math.floor(t/(o+h))+1)})})}else{this._applyIEPolyfillLayout()}};d.prototype._applyIEPolyfillLayout=function(){var e=this.$(),t=e.innerWidth(),i=Math.floor((t-h)/(o+h)),s=parseInt(e.css("padding-top").replace("px","")),r=parseInt(e.css("padding-left").replace("px","")),n=this.getItems(),g=this.$().children();if(!n.length){return}var l=new a;l.init({numberOfCols:Math.max(1,i),cellWidth:o,cellHeight:o,unitOfMeasure:"px",gapSize:h,topOffset:s?s:0,leftOffset:r?r:0});for(var d=0;d<n.length;d++){var u=n[d];var f=p(u);var c=jQuery(g.get(d));var m=jQuery(c.children().get(0)).outerHeight();var _=Math.floor(m/(o+h))+1;l.fitElement(d+"",f,_)}l.calculatePositions();for(var d=0;d<n.length;d++){var u=l.getItems()[d];var c=jQuery(g.get(d));c.css({position:"absolute",top:u.top,left:u.left})}e.css("height",l.getHeight()+"px")};return d});