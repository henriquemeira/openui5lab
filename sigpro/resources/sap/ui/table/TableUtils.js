/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ui/core/library","sap/ui/model/ChangeReason","./TableGrouping","./TableColumnUtils","./TableMenuUtils","./TableBindingUtils","./library","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,n,t,i,a,r,o,l,s,u,f,d){"use strict";var c=u.SelectionBehavior;var g=u.SelectionMode;var R=i.MessageType;var C;var p={DATACELL:1,COLUMNHEADER:2,ROWHEADER:4,ROWACTION:8,COLUMNROWHEADER:16};p.ANYCONTENTCELL=p.ROWHEADER|p.DATACELL|p.ROWACTION;p.ANYCOLUMNHEADER=p.COLUMNHEADER|p.COLUMNROWHEADER;p.ANYROWHEADER=p.ROWHEADER|p.COLUMNROWHEADER;p.ANY=p.ANYCONTENTCELL|p.ANYCOLUMNHEADER;var m=1;var v={sapUiSizeCozy:48,sapUiSizeCompact:32,sapUiSizeCondensed:24,undefined:32};var w={sapUiSizeCozy:v.sapUiSizeCozy+m,sapUiSizeCompact:v.sapUiSizeCompact+m,sapUiSizeCondensed:v.sapUiSizeCondensed+m,undefined:v.undefined+m};var T={Render:"Render",VerticalScroll:"VerticalScroll",FirstVisibleRowChange:"FirstVisibleRowChange",Unbind:"Unbind",Animation:"Animation",Resize:"Resize",Unknown:"Unknown"};for(var h in a){T[h]=a[h]}var I=":sapTabbable, .sapUiTableTreeIcon:not(.sapUiTableTreeIconLeaf)";var E={Grouping:r,Column:o,Menu:l,Binding:s,CELLTYPE:p,ROW_HORIZONTAL_FRAME_SIZE:m,DEFAULT_ROW_HEIGHT:w,RowsUpdateReason:T,INTERACTIVE_ELEMENT_SELECTORS:I,hasRowHeader:function(e){return e.getSelectionMode()!==g.None&&e.getSelectionBehavior()!==c.RowOnly||r.isGroupMode(e)},hasSelectAll:function(e){var n=e?e.getSelectionMode():g.None;return n===g.MultiToggle&&e.getEnableSelectAll()},hasRowHighlights:function(e){if(!e){return false}var n=e.getRowSettingsTemplate();if(!n){return false}var t=n.getHighlight();return n.isBound("highlight")||t!=null&&t!==R.None},getRowActionCount:function(e){var n=e.getRowActionTemplate();return n?n._getCount():0},hasRowActions:function(e){var n=e.getRowActionTemplate();return n!=null&&(n.isBound("visible")||n.getVisible())&&E.getRowActionCount(e)>0},isRowSelectionAllowed:function(e){return e.getSelectionMode()!==g.None&&(e.getSelectionBehavior()===c.Row||e.getSelectionBehavior()===c.RowOnly)},isRowSelectorSelectionAllowed:function(e){return e.getSelectionMode()!==g.None&&E.hasRowHeader(e)},areAllRowsSelected:function(e){if(!e){return false}var n=e._getSelectableRowCount();return n>0&&n===e._getSelectedIndicesCount()},isNoDataVisible:function(e){if(!e.getShowNoData()){return false}return!E.hasData(e)},hasData:function(e){var n=e.getBinding("rows");var t=e._getTotalRowCount();var i=t>0;if(n&&n.providesGrandTotal){var a=n.providesGrandTotal()&&n.hasTotaledMeasures();i=a&&t>1||!a&&t>0}return i},isBusyIndicatorVisible:function(e){if(!e||!e.getDomRef()){return false}return e.getDomRef().querySelector(".sapUiTableCnt > .sapUiLocalBusyIndicator")!=null},hasPendingRequests:function(e){if(!e){return false}if(E.canUsePendingRequestsCounter(e)){return e._iPendingRequests>0}else{return e._bPendingRequest}},canUsePendingRequestsCounter:function(e){var n=e?e.getBinding("rows"):null;if(E.isA(n,"sap.ui.model.analytics.AnalyticalBinding")){return n.bUseBatchRequests}else if(E.isA(n,"sap.ui.model.TreeBinding")){return false}return true},isA:function(n,t){return e.isA(n,t)},toggleRowSelection:function(e,n,t,i){if(!e||!e.getBinding("rows")||e.getSelectionMode()===g.None||n==null){return false}function a(n){if(!e._isRowSelectable(n)){return false}e._iSourceRowIndex=n;var a=false;if(i){a=i(n,t)}else if(e.isIndexSelected(n)){if(t!==true){a=true;e.removeSelectionInterval(n,n)}}else if(t!==false){a=true;e.addSelectionInterval(n,n)}delete e._iSourceRowIndex;return a}if(typeof n==="number"){if(n<0||n>=e._getTotalRowCount()){return false}return a(n)}else{var r=d(n);var o=E.getCellInfo(r[0]);var l=E.isRowSelectionAllowed(e);if(!E.Grouping.isInGroupingRow(r[0])&&(o.isOfType(E.CELLTYPE.DATACELL|E.CELLTYPE.ROWACTION)&&l||o.isOfType(E.CELLTYPE.ROWHEADER)&&E.isRowSelectorSelectionAllowed(e))){var s;if(o.isOfType(E.CELLTYPE.DATACELL)){s=e.getRows()[parseInt(r.closest("tr",e.getDomRef()).attr("data-sap-ui-rowindex"))].getIndex()}else{s=e.getRows()[parseInt(r.attr("data-sap-ui-rowindex"))].getIndex()}return a(s)}return false}},getNoDataText:function(e){var t=e.getNoData();if(t instanceof n){return null}else if(typeof t==="string"||e.getNoData()instanceof String){return t}else{return E.getResourceText("TBL_NO_DATA")}},getVisibleColumnCount:function(e){return e._getVisibleColumns().length},getHeaderRowCount:function(e){if(e._iHeaderRowCount===undefined){if(!e.getColumnHeaderVisible()){e._iHeaderRowCount=0}else{var n=1;var t=e.getColumns();for(var i=0;i<t.length;i++){if(t[i].shouldRender()){n=Math.max(n,t[i].getMultiLabels().length)}}e._iHeaderRowCount=n}}return e._iHeaderRowCount},isVariableRowHeightEnabled:function(e){return e&&e._bVariableRowHeightEnabled&&e.getFixedRowCount()<=0&&e.getFixedBottomRowCount()<=0},getTotalRowCount:function(e,n){var t=e._getTotalRowCount();if(n){t=Math.max(t,e.getVisibleRowCount())}return t},getNonEmptyVisibleRowCount:function(e){return Math.min(e.getVisibleRowCount(),e._getTotalRowCount())},getFocusedItemInfo:function(e){var n=e._getItemNavigation();if(!n){return null}return{cell:n.getFocusedIndex(),columnCount:n.iColumns,cellInRow:n.getFocusedIndex()%n.iColumns,row:Math.floor(n.getFocusedIndex()/n.iColumns),cellCount:n.getItemDomRefs().length,domRef:n.getFocusedDomRef()}},getRowIndexOfFocusedCell:function(e){var n=E.getFocusedItemInfo(e);return n.row-E.getHeaderRowCount(e)},isFixedColumn:function(e,n){return n<e.getComputedFixedColumnCount()},hasFixedColumns:function(e){return e.getComputedFixedColumnCount()>0},focusItem:function(e,n,t){var i=e._getItemNavigation();if(i){i.focusItem(n,t)}},getCellInfo:function(e){var n;var t=d(e);var i;var a;var r;var o;var l;n={type:0,cell:null,rowIndex:null,columnIndex:null,columnSpan:null};if(t.hasClass("sapUiTableTd")){i=t.data("sap-ui-colid");a=sap.ui.getCore().byId(i);n.type=E.CELLTYPE.DATACELL;n.rowIndex=parseInt(t.parent().data("sap-ui-rowindex"));n.columnIndex=a.getIndex();n.columnSpan=1}else if(t.hasClass("sapUiTableCol")){r=/_([\d]+)/;i=t.attr("id");o=r.exec(i);l=o&&o[1]!=null?parseInt(o[1]):0;n.type=E.CELLTYPE.COLUMNHEADER;n.rowIndex=l;n.columnIndex=parseInt(t.data("sap-ui-colindex"));n.columnSpan=parseInt(t.attr("colspan")||1)}else if(t.hasClass("sapUiTableRowHdr")){n.type=E.CELLTYPE.ROWHEADER;n.rowIndex=parseInt(t.data("sap-ui-rowindex"));n.columnIndex=-1;n.columnSpan=1}else if(t.hasClass("sapUiTableRowAction")){n.type=E.CELLTYPE.ROWACTION;n.rowIndex=parseInt(t.data("sap-ui-rowindex"));n.columnIndex=-2;n.columnSpan=1}else if(t.hasClass("sapUiTableColRowHdr")){n.type=E.CELLTYPE.COLUMNROWHEADER;n.columnIndex=-1;n.columnSpan=1}if(n.type!==0){n.cell=t}n.isOfType=function(e){if(e==null){return false}return(this.type&e)>0};return n},getRowColCell:function(e,n,t,i){var a=n>=0&&n<e.getRows().length?e.getRows()[n]:null;var r=i?e.getColumns():e._getVisibleColumns();var o=t>=0&&t<r.length?r[t]:null;var l=null;if(a&&o){if(i){if(o.shouldRender()){var s=e._getVisibleColumns();for(var u=0;u<s.length;u++){if(s[u]===o){l=a.getCells()[u];break}}}}else{l=a.getCells()[t]}if(l&&l.data("sap-ui-colid")!=o.getId()){var f=a.getCells();for(var u=0;u<f.length;u++){if(f[u].data("sap-ui-colid")===o.getId()){l=f[u];break}}}}return{row:a,column:o,cell:l}},getCell:function(e,n){if(!e||!n){return null}var t=d(n);var i;var a=e.getDomRef();var r=[".sapUiTableTd",".sapUiTableCol",".sapUiTableRowHdr",".sapUiTableRowAction",".sapUiTableColRowHdr"];var o;for(var l=0;l<r.length;l++){o=r[l];i=t.closest(o,a);if(i.length>0){return i}}return null},getParentCell:function(e,n){var t=d(n);var i=E.getCell(e,n);if(!i||i[0]===t[0]){return null}else{return i}},registerResizeHandler:function(e,n,i,a){var r;if(typeof n=="string"){r=e.getDomRef(n)}else{f.error("sIdSuffix must be a string",e);return}if(typeof i!=="function"){f.error("fnHandler must be a function",e);return}E.deregisterResizeHandler(e,n);if(!e._mResizeHandlerIds){e._mResizeHandlerIds={}}if(a&&r){r=r.parentNode}if(r){e._mResizeHandlerIds[n]=t.register(r,i)}return e._mResizeHandlerIds[n]},deregisterResizeHandler:function(e,n){var i;if(!e._mResizeHandlerIds){return}if(typeof n=="string"){i=[n]}else if(n===undefined){i=[];for(var a in e._mResizeHandlerIds){if(typeof a=="string"&&e._mResizeHandlerIds.hasOwnProperty(a)){i.push(a)}}}else if(Array.isArray(n)){i=n}for(var r=0;r<i.length;r++){var o=i[r];if(e._mResizeHandlerIds[o]){t.deregister(e._mResizeHandlerIds[o]);e._mResizeHandlerIds[o]=undefined}}},isFirstScrollableRow:function(e,n){if(isNaN(n)){var t=d(n);n=parseInt(t.add(t.parent()).filter("[data-sap-ui-rowindex]").data("sap-ui-rowindex"))}var i=e.getFixedRowCount()||0;return n==i},isLastScrollableRow:function(e,n){if(isNaN(n)){var t=d(n);n=parseInt(t.add(t.parent()).filter("[data-sap-ui-rowindex]").data("sap-ui-rowindex"))}var i=e.getFixedBottomRowCount()||0;return n==e.getVisibleRowCount()-i-1},getContentDensity:function(e){var n;var t=["sapUiSizeCondensed","sapUiSizeCompact","sapUiSizeCozy"];var i=function(e,n){if(!n[e]){return}for(var i=0;i<t.length;i++){if(n[e](t[i])){return t[i]}}};var a=e.$();if(a.length>0){n=i("hasClass",a)}else{n=i("hasStyleClass",e)}if(n){return n}var r=null;var o=e.getParent();if(o){do{n=i("hasStyleClass",o);if(n){return n}if(o.getDomRef){r=o.getDomRef()}else if(o.getRootNode){r=o.getRootNode()}if(!r&&o.getParent){o=o.getParent()}else{o=null}}while(o&&!r)}a=d(r||document.body);n=i("hasClass",a.closest("."+t.join(",.")));return n},isVariableWidth:function(e){return!e||e=="auto"||e.toString().match(/%$/)},getFirstFixedButtomRowIndex:function(e){var n=e.getFixedBottomRowCount();var t=e.getBinding("rows");var i=-1;if(t&&n>0){var a=e.getVisibleRowCount();var r=e.getFirstVisibleRow();var o=e._getTotalRowCount();if(o>=a){i=a-n}else{var l=o-n-r;if(l>=0&&r+l<o){i=l}}}return i},getResourceBundle:function(e){e=d.extend({async:false,reload:false},e);if(C&&e.reload!==true){if(e.async===true){return Promise.resolve(C)}else{return C}}var n=sap.ui.getCore().getLibraryResourceBundle("sap.ui.table",e.async===true);if(n instanceof Promise){n=n.then(function(e){C=e;return C})}else{C=n}return n},getResourceText:function(e,n){return C?C.getText(e,n):""},dynamicCall:function(e,n,t){var i=e instanceof Function?e():e;if(!i||!n){return undefined}t=t||i;if(n instanceof Function){n.call(t,i);return undefined}else{var a;var r=[];for(var o in n){if(i[o]instanceof Function){a=n[o];r.push(i[o].apply(t,a))}else{r.push(undefined)}}if(r.length===1){return r[0]}else{return r}}},throttle:function(e,n){n=Object.assign({wait:0,leading:true},n);n.maxWait=n.wait;n.trailing=true;n.requestAnimationFrame=false;return E.debounce(e,n)},debounce:function(e,n){n=Object.assign({wait:0,maxWait:null,leading:false,asyncLeading:false,trailing:true,requestAnimationFrame:false},n);var t=null;var i=null;var a=null;var r=n.maxWait!=null;n.wait=Math.max(0,n.wait);n.maxWait=r?Math.max(n.maxWait,n.wait):n.maxWait;function o(n,i,r,o){t=o===true?null:Date.now();if(i==null){return}if(r===true){var l=Promise.resolve().then(function(){if(!l.canceled){e.apply(n,i)}a=null});l.cancel=function(){l.canceled=true};a=l}else{e.apply(n,i)}}function l(e,a){s();function l(t){t=t!==false;if(t){f()}if(n.trailing){o(e,a,null,t)}}if(n.requestAnimationFrame){i=window.requestAnimationFrame(function(){l()})}else{var u=Date.now();var d=t==null?0:u-t;var c=Math.max(0,r?Math.min(n.maxWait-d,n.wait):n.wait);var g=c<n.wait;i=setTimeout(function(){if(g){var e=Math.max(0,Date.now()-u-c);var t=n.wait-c;if(e>t){l()}else{i=setTimeout(f,t-e);l(false)}}else{l()}},c)}}function s(){if(n.requestAnimationFrame){window.cancelAnimationFrame(i)}else{clearTimeout(i)}i=null}function u(){if(a){a.cancel();a=null}}function f(){s();u();t=null}function d(){return i!=null}var c=function(){if(!d()&&!n.leading){o()}if(d()||!n.leading){l(this,arguments)}else if(n.asyncLeading){o(this,arguments,true);l()}else{l();o(this,arguments)}};c.cancel=f;c.pending=d;return c},getInteractiveElements:function(e){if(!e){return null}var n=d(e);var t=E.getCellInfo(n);if(t.isOfType(p.DATACELL|p.ROWACTION)){var i=n.find(I);if(i.length>0){return i}}return null}};r.TableUtils=E;o.TableUtils=E;l.TableUtils=E;s.TableUtils=E;return E},true);