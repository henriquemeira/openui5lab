/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableExtension","sap/ui/table/TableUtils","sap/ui/core/library"],function(t,e,a){"use strict";var o="sap.ui.table";var r=a.dnd.DropPosition;var i={getSessionData:function(t,e){return t.getComplexData(o+(e==null?"":"-"+e))},setSessionData:function(t,e,a){t.setComplexData(o+(a==null?"":"-"+a),e)},getInstanceSessionData:function(t,e){return this.getSessionData(t,e.getId())},setInstanceSessionData:function(t,e,a){this.setSessionData(t,a,e.getId())}};var n={ondragstart:function(t){var e=t.dragSession;if(!e||!e.getDragControl()){return}var a=e.getDragControl();var o={};if(a.isA("sap.ui.table.Row")){var r=this.getContextByIndex(a.getIndex());var n=a.getDomRef();if(!r||n.classList.contains("sapUiTableGroupHeader")||n.classList.contains("sapUiAnalyticalTableSum")){t.preventDefault();return}else{o.draggedRowContext=r}}i.setInstanceSessionData(e,this,o)},ondragenter:function(t){var a=t.dragSession;if(!a||!a.getDropControl()){return}var o=i.getInstanceSessionData(a,this);var n=a.getDragControl();var s=a.getDropControl();if(!o){o={}}if(s.isA("sap.ui.table.Row")){var l=o.draggedRowContext;var g=this.getContextByIndex(s.getIndex());var f=s.getDomRef();var c=a.getDropInfo().getDropPosition();if(!g&&c===r.On&&e.hasData(this)||l&&l===g||f.classList.contains("sapUiTableGroupHeader")||f.classList.contains("sapUiAnalyticalTableSum")){t.setMarked("NonDroppable")}else{if(!g){var v=this.getRows()[e.getNonEmptyVisibleRowCount(this)-1];a.setDropControl(v||this)}if(a.getDropControl()!==this){var p=this.getDomRef().classList.contains("sapUiTableVScr");var d=this.getDomRef("sapUiTableCnt").getBoundingClientRect();a.setIndicatorConfig({width:d.width-(p?16:0),left:d.left+(this._bRtlMode&&p?16:0)})}}}else if(n===s){t.setMarked("NonDroppable")}if(!o.verticalScrollEdge){var u=window.pageYOffset;var D=this.getDomRef("table").getBoundingClientRect();o.verticalScrollEdge={bottom:D.bottom+u,top:D.top+u}}var h=window.pageXOffset;var b=this.getDomRef("sapUiTableCtrlScr").getBoundingClientRect();o.horizontalScrollEdge={left:b.left+h,right:b.right+h};i.setInstanceSessionData(a,this,o)},ondragover:function(t){var e=t.dragSession;if(!e){return}var a=i.getInstanceSessionData(e,this);if(!a){return}var o=32;var r=50;var n=e.getDropControl();var s=this._getScrollExtension();var l=s.getVerticalScrollbar();var g=s.getHorizontalScrollbar();var f=a.verticalScrollEdge;var c=a.horizontalScrollEdge;if(f&&l&&n!==this){var v=t.pageY;if(v>=f.top-r&&v<=f.top+r){l.scrollTop-=o}else if(v<=f.bottom+r&&v>=f.bottom-r){l.scrollTop+=o}}if(c&&g&&n!==this){var p=t.pageX;if(p>=c.left-r&&p<=c.left+r){g.scrollLeft-=o}else if(p<=c.right+r&&p>=c.right-r){g.scrollLeft+=o}}},onlongdragover:function(t){var a=t.dragSession;if(!a){return}var o=e.getCell(this,t.target);var r=e.getCellInfo(o).rowIndex;var i=r==null?null:this.getRows()[r];var n=a.getDropControl();if(i&&(n==i||!n)){e.Grouping.toggleGroupHeader(this,i.getIndex(),true)}}};var s=t.extend("sap.ui.table.TableDragAndDropExtension",{_init:function(t,e,a){this._oDelegate=n;t.addEventDelegate(this._oDelegate,t);return"DragAndDropExtension"},_debug:function(){this._ExtensionDelegate=n},destroy:function(){var e=this.getTable();if(e){e.removeEventDelegate(this._oDelegate)}this._oDelegate=null;t.prototype.destroy.apply(this,arguments)}});return s});