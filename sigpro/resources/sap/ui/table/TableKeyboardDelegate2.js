/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/Device","./library","./TableUtils","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery"],function(e,t,i,o,n,s){"use strict";var r=o.CELLTYPE;var l=i.SelectionMode;var a={CTRL:1,SHIFT:2,ALT:4};var f={LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down"};var u=5;var c="1em";function g(e,t){e.setMarked("sapUiTableSkipItemNavigation",t!==false)}var v=e.extend("sap.ui.table.TableKeyboardDelegate2",{constructor:function(t){e.call(this)},destroy:function(){e.prototype.destroy.apply(this,arguments)},getInterface:function(){return this}});v._restoreFocusOnLastFocusedDataCell=function(e,t){var i=o.getFocusedItemInfo(e);var n=e._getKeyboardExtension()._getLastFocusedCellInfo();o.focusItem(e,i.cellInRow+i.columnCount*n.row,t)};v._setFocusOnColumnHeaderOfLastFocusedDataCell=function(e,t){var i=o.getFocusedItemInfo(e);o.focusItem(e,i.cellInRow,t)};v._forwardFocusToTabDummy=function(e,t){e._getKeyboardExtension()._setSilentFocus(e.$().find("."+t))};v._isKeyCombination=function(e,i,o){if(o==null){o=0}var s=typeof i==="string"?String.fromCharCode(e.charCode):e.keyCode;var r=0;r|=(t.os.macintosh?e.metaKey:e.ctrlKey)&&i!==n.CONTROL?a.CTRL:0;r|=e.shiftKey&&i!==n.SHIFT?a.SHIFT:0;r|=e.altKey&&i!==n.ALT?a.ALT:0;var l=i==null||s===i;var f=o===r;return l&&f};v._handleSpaceAndEnter=function(e,t){var i=o.getCellInfo(t.target);if(i.isOfType(r.COLUMNROWHEADER)){e._toggleSelectAll()}else if(v._isElementGroupToggler(e,t.target)){o.Grouping.toggleGroupHeaderByRef(e,t.target)}else if(i.isOfType(r.ROWHEADER)){o.toggleRowSelection(e,t.target)}else if(i.isOfType(r.DATACELL|r.ROWACTION)){var n=!e.hasListeners("cellClick");if(!e._findAndfireCellEvent(e.fireCellClick,t)){if(o.isRowSelectionAllowed(e)){o.toggleRowSelection(e,t.target);n=false}}if(n){var s=o.getInteractiveElements(t.target);if(s){e._getKeyboardExtension().setActionMode(true)}}}};v._moveColumn=function(e,t){var i=e.getParent();var n=i._getVisibleColumns();var s=n.indexOf(e);var r;if(t&&s<n.length-1){r=i.indexOfColumn(n[s+1])+1}else if(!t&&s>0){r=i.indexOfColumn(n[s-1])}if(r!=null){o.Column.moveColumnTo(e,r)}};v._getVisibleAndGroupedColumns=function(e){return e.getColumns().filter(function(e){return e.getVisible()||e.getGrouped()})};v._getColumnIndexInVisibleAndGroupedColumns=function(e,t){var i=v._getVisibleAndGroupedColumns(e);for(var o=0;o<i.length;o++){var n=i[o];if(n===t){return o}}return-1};v._focusElement=function(e,t,i){if(!e||!t){return}if(i==null){i=false}function o(e){return e instanceof window.HTMLInputElement&&/^(text|password|search|tel|url)$/.test(e.type)}if(o(document.activeElement)){document.activeElement.setSelectionRange(0,0)}if(i){e._getKeyboardExtension()._setSilentFocus(t)}else{t.focus()}if(o(t)){t.select()}};v._focusCell=function(e,t,i,n,s){if(!e||t==null||i==null||i<0||i>=e.getRows().length){return}var l=e.getRows()[i];var a;if(t===r.ROWHEADER){e._getKeyboardExtension()._setFocus(e.getDomRef("rowsel"+i));return}else if(t===r.ROWACTION){a=e.getDomRef("rowact"+i)}else if(t===r.DATACELL&&(n!=null&&n>=0)){var f=e.getColumns()[n];var u=v._getColumnIndexInVisibleAndGroupedColumns(e,f);if(u>=0&&u<o.getVisibleColumnCount(e)){a=l.getDomRef("col"+u)}}if(!a){return}if(s){var c=o.getInteractiveElements(a);if(c){v._focusElement(e,c[0]);return}}a.focus()};v._navigate=function(e,t,i){if(t.isMarked()){return}var n=e._getKeyboardExtension();var s=n.isInActionMode();var l=o.getCellInfo(o.getCell(e,t.target));var u=false;if((i===f.UP||i===f.DOWN)&&l.isOfType(r.ANYCONTENTCELL)){var c=v._isKeyCombination(t,null,a.CTRL);var C=c||s;var p=o.getParentCell(e,t.target);var h=s&&l.isOfType(r.DATACELL);if(!c&&(t.target instanceof window.HTMLInputElement||t.target instanceof window.HTMLTextAreaElement)){return}if(!C&&p){p.focus();return}g(t);if(i===f.UP){if(o.isFirstScrollableRow(e,l.cell)){u=e._getScrollExtension().scrollVertically(false,false,true,h,function(){if(h){document.activeElement.blur()}})}}else if(o.isLastScrollableRow(e,l.cell)){u=e._getScrollExtension().scrollVertically(true,false,true,h,function(){if(h){document.activeElement.blur()}})}if(u){t.preventDefault();if(C){e.attachEventOnce("_rowsUpdated",function(){setTimeout(function(){v._focusCell(e,l.type,l.rowIndex,l.columnIndex,true)},0)})}}else if(i===f.UP&&l.rowIndex===0){g(t,l.isOfType(r.ROWACTION)||C);if(!s&&p){p.focus()}else{n.setActionMode(false)}}else if(i===f.DOWN&&l.rowIndex===e.getVisibleRowCount()-1){if(!s&&p){p.focus()}else{n.setActionMode(false)}}else{var d=i===f.DOWN?1:-1;v._focusCell(e,l.type,l.rowIndex+d,l.columnIndex,C);t.preventDefault()}}else if(i===f.DOWN&&l.isOfType(r.ANYCOLUMNHEADER)){var m=o.getHeaderRowCount(e);if(o.isNoDataVisible(e)){var E=o.getFocusedItemInfo(e);if(E.row-m<=1){g(t)}}else if(l.isOfType(r.COLUMNROWHEADER)&&m>1){g(t);o.focusItem(e,m*(o.getVisibleColumnCount(e)+1),t)}}else if(i===f.LEFT&&!s){var I=sap.ui.getCore().getConfiguration().getRTL();if(l.isOfType(r.COLUMNHEADER)&&I){var R=o.getFocusedItemInfo(e);var T=R.cellInRow-(o.hasRowHeader(e)?1:0);var y=o.getVisibleColumnCount(e);if(o.hasRowActions(e)&&T===y-1){g(t)}}}};v._isElementGroupToggler=function(e,t){return o.Grouping.isInGroupingRow(t)||o.Grouping.isTreeMode(e)&&t.classList.contains("sapUiTableTdFirst")&&(t.querySelector(".sapUiTableTreeIconNodeOpen")||t.querySelector(".sapUiTableTreeIconNodeClosed"))||t.classList.contains("sapUiTableTreeIconNodeOpen")||t.classList.contains("sapUiTableTreeIconNodeClosed")};v._isElementInteractive=function(e){if(!e){return false}return s(e).is(o.INTERACTIVE_ELEMENT_SELECTORS)};v._getFirstInteractiveElement=function(e){if(!e){return null}var t=e.getParent();var i=e.getCells();var n;var s;if(o.hasRowActions(t)){i.push(e.getAggregation("_rowAction"))}for(var r=0;r<i.length;r++){n=o.getParentCell(t,i[r].getDomRef());s=o.getInteractiveElements(n);if(s){return s.first()}}return null};v._getLastInteractiveElement=function(e){if(!e){return null}var t=e.getParent();var i=e.getCells();var n;var s;if(o.hasRowActions(t)){i.push(e.getAggregation("_rowAction"))}for(var r=i.length-1;r>=0;r--){n=o.getParentCell(t,i[r].getDomRef());s=o.getInteractiveElements(n);if(s){return s.last()}}return null};v._getPreviousInteractiveElement=function(e,t){if(!e||!t){return null}var i=s(t);if(!this._isElementInteractive(i)){return null}var n=o.getParentCell(e,t);var l;var a;var f;var u;var c;var g;var C;l=o.getInteractiveElements(n);if(l[0]!==i[0]){return l.eq(l.index(t)-1)}a=o.getCellInfo(n);u=e.getRows()[a.rowIndex].getCells();if(a.isOfType(r.ROWACTION)){C=u.length-1}else{c=e.getColumns()[a.columnIndex];g=v._getColumnIndexInVisibleAndGroupedColumns(e,c);C=g-1}for(var p=C;p>=0;p--){f=u[p].getDomRef();n=o.getParentCell(e,f);l=o.getInteractiveElements(n);if(l){return l.last()}}return null};v._getNextInteractiveElement=function(e,t){if(!e||!t){return null}var i=s(t);if(!this._isElementInteractive(i)){return null}var n=o.getParentCell(e,t);var l;var a;var f;var u;var c;var g;var C;l=o.getInteractiveElements(n);if(l.get(-1)!==i[0]){return l.eq(l.index(t)+1)}a=o.getCellInfo(n);if(a.isOfType(r.ROWACTION)){return null}g=e.getRows()[a.rowIndex];u=g.getCells();c=e.getColumns()[a.columnIndex];C=v._getColumnIndexInVisibleAndGroupedColumns(e,c);for(var p=C+1;p<u.length;p++){f=u[p].getDomRef();n=o.getParentCell(e,f);l=o.getInteractiveElements(n);if(l){return l.first()}}if(o.hasRowActions(e)){n=o.getParentCell(e,g.getAggregation("_rowAction").getDomRef());l=o.getInteractiveElements(n);if(l.get(-1)!==i[0]){return l.eq(l.index(t)+1)}}return null};v.prototype.enterActionMode=function(){var e=this._getKeyboardExtension();var t=document.activeElement;var i=o.getInteractiveElements(t);var n=o.getParentCell(this,t);if(i){e._suspendItemNavigation();t.tabIndex=-1;v._focusElement(this,i[0],true);return true}else if(n){this._getKeyboardExtension()._suspendItemNavigation();return true}return false};v.prototype.leaveActionMode=function(e){e=e==null?true:e;var t=this._getKeyboardExtension();var i=document.activeElement;var n=o.getParentCell(this,i);t._resumeItemNavigation();if(e){if(n){v._focusElement(this,n[0],true)}else{t._setSilentFocus(i)}}};v.prototype.onfocusin=function(e){if(e.isMarked("sapUiTableIgnoreFocusIn")){return}var t=s(e.target);if(t.hasClass("sapUiTableOuterBefore")||t.hasClass("sapUiTableOuterAfter")||e.target!=this.getDomRef("overlay")&&this.getShowOverlay()){this.$("overlay").focus()}else if(t.hasClass("sapUiTableCtrlBefore")){var i=o.isNoDataVisible(this);if(!i||i&&this.getColumnHeaderVisible()){v._setFocusOnColumnHeaderOfLastFocusedDataCell(this,e)}else{this._getKeyboardExtension()._setSilentFocus(this.$("noDataCnt"))}}else if(t.hasClass("sapUiTableCtrlAfter")){if(!o.isNoDataVisible(this)){v._restoreFocusOnLastFocusedDataCell(this,e)}}var n=o.getParentCell(this,t);var l=n!==null;var a=l&&v._isElementInteractive(t);if(this._getKeyboardExtension().isInActionMode()){var f=o.getCellInfo(e.target);var u=f.cell!=null;var c=f.isOfType(r.ROWHEADER)&&o.Grouping.isInGroupingRow(e.target);var g=f.isOfType(r.ROWHEADER)&&!c&&o.isRowSelectorSelectionAllowed(this);if(u&&!c&&!g){this._getKeyboardExtension().setActionMode(false)}else if(l&&!a){this._getKeyboardExtension().setActionMode(false,false)}}else if(a){this._getKeyboardExtension().setActionMode(true)}};v.prototype.onkeydown=function(e){var t=this._getKeyboardExtension();if(v._isKeyCombination(e,n.F2)){var i=t.isInActionMode();var f=o.getParentCell(this,e.target);if(!i&&f){f.focus()}else{t.setActionMode(!i)}return}else if(v._isKeyCombination(e,n.F4)&&v._isElementGroupToggler(this,e.target)){o.Grouping.toggleGroupHeaderByRef(this,e.target);return}if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(e,n.SPACE)&&o.getCellInfo(e.target).type){e.preventDefault()}var u=s(e.target);var c=o.getCellInfo(u);var g=this.getSelectionMode();if(v._isKeyCombination(e,n.SHIFT)&&g===l.MultiToggle&&(c.isOfType(r.ROWHEADER)&&o.isRowSelectorSelectionAllowed(this)||c.isOfType(r.DATACELL|r.ROWACTION)&&o.isRowSelectionAllowed(this))){var C=o.getRowIndexOfFocusedCell(this);var p=this.getRows()[C].getIndex();this._oRangeSelection={startIndex:p,selected:this.isIndexSelected(p)}}else if(v._isKeyCombination(e,n.A,a.CTRL)){e.preventDefault();if(c.isOfType(r.ANYCONTENTCELL|r.COLUMNROWHEADER)&&g===l.MultiToggle){this._toggleSelectAll()}}else if(v._isKeyCombination(e,n.A,a.CTRL+a.SHIFT)){if(c.isOfType(r.ANYCONTENTCELL|r.COLUMNROWHEADER)){this.clearSelection()}}else if(v._isKeyCombination(e,n.F4)){if(c.isOfType(r.DATACELL)){t.setActionMode(true)}}else if(v._isKeyCombination(e,n.F10,a.SHIFT)){e.preventDefault();o.Menu.openContextMenu(this,e.target,true,null,e)}};v.prototype.onkeypress=function(e){var t=this._getKeyboardExtension();var i=o.getCellInfo(e.target);if(v._isKeyCombination(e,"+")){if(v._isElementGroupToggler(this,e.target)){o.Grouping.toggleGroupHeaderByRef(this,e.target,true)}else if(i.isOfType(r.DATACELL|r.ROWACTION)){t.setActionMode(true)}}else if(v._isKeyCombination(e,"-")){if(v._isElementGroupToggler(this,e.target)){o.Grouping.toggleGroupHeaderByRef(this,e.target,false)}else if(i.isOfType(r.DATACELL|r.ROWACTION)){t.setActionMode(true)}}};v.prototype.oncontextmenu=function(e){if(e.isMarked("handledByPointerExtension")){return}e.preventDefault();var t=o.getCell(this,e.target);var i=o.getCellInfo(t);if(i.isOfType(r.COLUMNHEADER|r.ANYCONTENTCELL)){o.Menu.openContextMenu(this,e.target,true,null,e)}};v.prototype.onkeyup=function(e){var t=o.getCellInfo(e.target);if(v._isKeyCombination(e,n.SHIFT)){delete this._oRangeSelection}if(v._isKeyCombination(e,n.SPACE)){if(t.isOfType(r.COLUMNHEADER)){o.Menu.openContextMenu(this,e.target,true)}else{v._handleSpaceAndEnter(this,e)}}if(v._isKeyCombination(e,n.ENTER)){if(t.isOfType(r.COLUMNHEADER)){o.Menu.openContextMenu(this,e.target,true)}}};v.prototype.onsaptabnext=function(e){var t=this._getKeyboardExtension();var i=o.getCellInfo(e.target);var n;if(t.isInActionMode()){var s;n=o.getCell(this,e.target);i=o.getCellInfo(n);if(!n){return}var l=this.getRows()[i.rowIndex];var a=v._getLastInteractiveElement(l);var f=a===null||a[0]===e.target;if(f){var u=l.getIndex();var c=o.isLastScrollableRow(this,n);var g=this._getTotalRowCount()-1===u;var C=o.isRowSelectorSelectionAllowed(this);var p=false;if(!g&&c){var h=i.isOfType(r.DATACELL);p=this._getScrollExtension().scrollVertically(true,false,true,h,function(){if(h){document.activeElement.blur()}})}if(g){e.preventDefault();t.setActionMode(false)}else if(p){e.preventDefault();this.attachEventOnce("_rowsUpdated",function(){setTimeout(function(){var e=o.Grouping.isGroupingRow(l.getDomRef());if(C||e){v._focusCell(this,r.ROWHEADER,i.rowIndex)}else{s=v._getFirstInteractiveElement(l);v._focusElement(this,s[0])}}.bind(this),0)}.bind(this))}else{e.preventDefault();var d=i.rowIndex+1;var m=this.getRows()[d];var E=o.Grouping.isGroupingRow(m.getDomRef());if(C||E){v._focusCell(this,r.ROWHEADER,d)}else{s=v._getFirstInteractiveElement(m);v._focusElement(this,s[0])}}}else if(i.isOfType(r.ROWHEADER)){e.preventDefault();s=v._getFirstInteractiveElement(l);v._focusElement(this,s[0])}else{e.preventDefault();s=v._getNextInteractiveElement(this,e.target);v._focusElement(this,s[0])}}else if(i.isOfType(r.ANYCOLUMNHEADER)){if(o.isNoDataVisible(this)){this.$("noDataCnt").focus()}else{v._restoreFocusOnLastFocusedDataCell(this,e)}e.preventDefault()}else if(i.isOfType(r.ANYCONTENTCELL)){v._forwardFocusToTabDummy(this,"sapUiTableCtrlAfter")}else if(e.target===this.getDomRef("overlay")){t._setSilentFocus(this.$().find(".sapUiTableOuterAfter"))}else if(!i.cell){n=o.getParentCell(this,e.target);if(n){e.preventDefault();n.focus()}}};v.prototype.onsaptabprevious=function(e){var t=this._getKeyboardExtension();var i=o.getCellInfo(e.target);var n;if(t.isInActionMode()){var s;n=o.getCell(this,e.target);i=o.getCellInfo(n);if(!n){return}var l=this.getRows()[i.rowIndex];var a=l.getIndex();var f=v._getFirstInteractiveElement(l);var u=f!==null&&f[0]===e.target;var c=o.isRowSelectorSelectionAllowed(this);var g=o.Grouping.isGroupingRow(l);var C=c||g;if(u&&C){e.preventDefault();v._focusCell(this,r.ROWHEADER,i.rowIndex)}else if(u&&!C||i.isOfType(r.ROWHEADER)){var p=o.isFirstScrollableRow(this,n);var h=a===0;var d=false;if(!h&&p){var m=i.isOfType(r.DATACELL);d=this._getScrollExtension().scrollVertically(false,false,true,m,function(){if(m){document.activeElement.blur()}})}if(h){e.preventDefault();t.setActionMode(false)}else if(d){e.preventDefault();this.attachEventOnce("_rowsUpdated",function(){setTimeout(function(){var e=o.Grouping.isGroupingRow(l.getDomRef());if(e){v._focusCell(this,r.ROWHEADER,i.rowIndex)}else{s=v._getLastInteractiveElement(l);v._focusElement(this,s[0])}}.bind(this),0)}.bind(this))}else{e.preventDefault();var E=i.rowIndex-1;var I=this.getRows()[E];var R=o.Grouping.isGroupingRow(I.getDomRef());if(R){v._focusCell(this,r.ROWHEADER,E)}else{s=v._getLastInteractiveElement(I);v._focusElement(this,s[0])}}}else{e.preventDefault();s=v._getPreviousInteractiveElement(this,e.target);v._focusElement(this,s[0])}}else if(i.isOfType(r.ANYCONTENTCELL)||e.target===this.getDomRef("noDataCnt")){if(this.getColumnHeaderVisible()&&!i.isOfType(r.ROWACTION)){v._setFocusOnColumnHeaderOfLastFocusedDataCell(this,e);e.preventDefault()}else{v._forwardFocusToTabDummy(this,"sapUiTableCtrlBefore")}}else if(e.target===this.getDomRef("overlay")){this._getKeyboardExtension()._setSilentFocus(this.$().find(".sapUiTableOuterBefore"))}else if(!i.cell){n=o.getParentCell(this,e.target);if(n){e.preventDefault();n.focus()}}};v.prototype.onsapdown=function(e){v._navigate(this,e,f.DOWN)};v.prototype.onsapdownmodifiers=function(e){if(v._isKeyCombination(e,null,a.CTRL)){v._navigate(this,e,f.DOWN);return}var t=this._getKeyboardExtension();if(v._isKeyCombination(e,null,a.ALT)&&v._isElementGroupToggler(this,e.target)){g(e);o.Grouping.toggleGroupHeaderByRef(this,e.target,true);return}if(t.isInActionMode()){return}var i=o.getCellInfo(e.target);if(v._isKeyCombination(e,null,a.SHIFT)){e.preventDefault();if(i.isOfType(r.ANYCONTENTCELL)){if(!this._oRangeSelection){g(e);return}var n=o.getRowIndexOfFocusedCell(this);var s=this.getRows()[n].getIndex();if(s===this._getTotalRowCount()-1){return}if(o.isLastScrollableRow(this,e.target)){var l=this._getScrollExtension().scrollVertically(true,false,true);if(l){g(e)}}if(this._oRangeSelection.startIndex<=s){s++;if(this._oRangeSelection.selected){o.toggleRowSelection(this,s,true)}else{o.toggleRowSelection(this,s,false)}}else{o.toggleRowSelection(this,s,false)}}else{g(e)}}if(v._isKeyCombination(e,null,a.ALT)){if(i.isOfType(r.DATACELL)){t.setActionMode(true)}g(e)}};v.prototype.onsapup=function(e){v._navigate(this,e,f.UP)};v.prototype.onsapupmodifiers=function(e){var t=this._getKeyboardExtension();if(v._isKeyCombination(e,null,a.CTRL)){v._navigate(this,e,f.UP);return}if(v._isKeyCombination(e,null,a.ALT)&&v._isElementGroupToggler(this,e.target)){g(e);o.Grouping.toggleGroupHeaderByRef(this,e.target,false);return}if(t.isInActionMode()){return}var i=o.getCellInfo(e.target);if(v._isKeyCombination(e,null,a.SHIFT)){e.preventDefault();if(i.isOfType(r.ANYCONTENTCELL)){if(!this._oRangeSelection){g(e);return}var n=o.getRowIndexOfFocusedCell(this);var s=this.getRows()[n].getIndex();if(s===0){g(e);return}if(o.isFirstScrollableRow(this,e.target)){var l=this._getScrollExtension().scrollVertically(false,false,true);if(l){g(e)}}if(this._oRangeSelection.startIndex>=s){s--;if(this._oRangeSelection.selected){o.toggleRowSelection(this,s,true)}else{o.toggleRowSelection(this,s,false)}}else{o.toggleRowSelection(this,s,false)}}else{g(e)}}if(v._isKeyCombination(e,null,a.ALT)){if(i.isOfType(r.DATACELL)){t.setActionMode(true)}g(e)}};v.prototype.onsapleft=function(e){v._navigate(this,e,f.LEFT)};v.prototype.onsapleftmodifiers=function(e){if(this._getKeyboardExtension().isInActionMode()){return}var t=o.getCellInfo(e.target);var i=sap.ui.getCore().getConfiguration().getRTL();if(v._isKeyCombination(e,null,a.SHIFT)){e.preventDefault();if(t.isOfType(r.DATACELL)){if(!this._oRangeSelection){g(e);return}var n=o.getFocusedItemInfo(this);var s=o.hasRowHeader(this)&&n.cellInRow===1;if(s&&!o.isRowSelectorSelectionAllowed(this)){g(e)}}else if(t.isOfType(r.ROWACTION)){if(!this._oRangeSelection){g(e)}}else if(t.isOfType(r.ROWHEADER)&&i){if(!o.isRowSelectionAllowed(this)){g(e)}}else if(t.isOfType(r.COLUMNROWHEADER)&&i){g(e)}else if(t.isOfType(r.COLUMNHEADER)){var l=-this._CSSSizeToPixel(c);var f=0;if(i){l=l*-1}for(var u=t.columnIndex;u<t.columnIndex+t.columnSpan;u++){f+=o.Column.getColumnWidth(this,u)}o.Column.resizeColumn(this,t.columnIndex,f+l,true,t.columnSpan);g(e)}}else if(v._isKeyCombination(e,null,a.CTRL)){if(t.isOfType(r.COLUMNHEADER)){e.preventDefault();e.stopImmediatePropagation();var C=this.getColumns()[t.columnIndex];v._moveColumn(C,i)}}};v.prototype.onsaprightmodifiers=function(e){if(this._getKeyboardExtension().isInActionMode()){return}var t=o.getCellInfo(e.target);var i=sap.ui.getCore().getConfiguration().getRTL();if(v._isKeyCombination(e,null,a.SHIFT)){e.preventDefault();if(t.isOfType(r.DATACELL)){if(!this._oRangeSelection){g(e)}}else if(t.isOfType(r.ROWHEADER)){if(!o.isRowSelectionAllowed(this)){g(e)}}else if(t.isOfType(r.ROWACTION)&&i){if(!this._oRangeSelection){g(e)}}else if(t.isOfType(r.COLUMNHEADER)){var n=this._CSSSizeToPixel(c);var s=0;if(i){n=n*-1}for(var l=t.columnIndex;l<t.columnIndex+t.columnSpan;l++){s+=o.Column.getColumnWidth(this,l)}o.Column.resizeColumn(this,t.columnIndex,s+n,true,t.columnSpan);g(e)}else if(t.isOfType(r.COLUMNROWHEADER)){g(e)}}else if(v._isKeyCombination(e,null,a.CTRL)){if(t.isOfType(r.COLUMNHEADER)){e.preventDefault();e.stopImmediatePropagation();var f=this.getColumns()[t.columnIndex];v._moveColumn(f,!i)}}};v.prototype.onsaphome=function(e){if(this._getKeyboardExtension().isInActionMode()){return}if(o.Grouping.isInGroupingRow(e.target)){g(e);e.preventDefault();return}var t=o.getCellInfo(e.target);if(t.isOfType(r.ANY)){e.preventDefault()}if(t.isOfType(r.DATACELL|r.ROWACTION|r.COLUMNHEADER)){var i=o.getFocusedItemInfo(this);var n=i.cell;var s=i.cellInRow;var l=this.getComputedFixedColumnCount();var a=o.hasRowHeader(this);var f=a?1:0;if(o.hasFixedColumns(this)&&s>l+f){g(e);o.focusItem(this,n-s+l+f,null)}else if(a&&s>1){g(e);o.focusItem(this,n-s+f,null)}}};v.prototype.onsapend=function(e){if(this._getKeyboardExtension().isInActionMode()){return}if(o.Grouping.isInGroupingRow(e.target)){e.preventDefault();g(e);return}var t=o.getCellInfo(e.target);if(t.isOfType(r.ANY)){e.preventDefault();var i=o.getFocusedItemInfo(this);var n=i.cell;var s=i.columnCount;var l=this.getComputedFixedColumnCount();var a=i.cellInRow;var f=o.hasRowHeader(this);var u=f?1:0;var c=false;if(t.isOfType(r.COLUMNHEADER)&&o.hasFixedColumns(this)){var v=parseInt(t.cell.attr("colspan")||1);if(v>1&&a+v-u===l){c=true}}if(f&&a===0){g(e);o.focusItem(this,n+1,null)}else if(o.hasFixedColumns(this)&&a<l-1+u&&!c){g(e);o.focusItem(this,n+l-a,null)}else if(o.hasRowActions(this)&&t.isOfType(r.DATACELL)&&a<s-2){g(e);o.focusItem(this,n-a+s-2,null)}}};v.prototype.onsaphomemodifiers=function(e){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(e,null,a.CTRL)){e.preventDefault();var t=o.getCellInfo(e.target);if(t.isOfType(r.ANYCONTENTCELL|r.COLUMNHEADER)){g(e);var i=o.getFocusedItemInfo(this);var n=i.row;if(n>0){var s=i.cell;var l=i.columnCount;var f=o.getHeaderRowCount(this);var u=this.getFixedRowCount();var c=this.getFixedBottomRowCount();if(n<f+u){if(t.isOfType(r.ROWACTION)){o.focusItem(this,s-l*(n-f),e)}else{o.focusItem(this,s-l*n,e)}}else if(n>=f+u&&n<f+o.getNonEmptyVisibleRowCount(this)-c){this._getScrollExtension().scrollVerticallyMax(false,true);if(u>0||t.isOfType(r.ROWACTION)){o.focusItem(this,s-l*(n-f),e)}else{o.focusItem(this,s-l*n,e)}}else{this._getScrollExtension().scrollVerticallyMax(false,true);o.focusItem(this,s-l*(n-f-u),e)}}}}};v.prototype.onsapendmodifiers=function(e){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(e,null,a.CTRL)){e.preventDefault();var t=o.getCellInfo(e.target);if(t.isOfType(r.ANY)){var i=o.getFocusedItemInfo(this);var n=i.row;var s=o.getHeaderRowCount(this);var l=o.getNonEmptyVisibleRowCount(this);var f=this.getFixedRowCount();var u=this.getFixedBottomRowCount();g(e);if(u===0||n<s+l-1||o.isNoDataVisible(this)&&n<s-1){var c=i.cell;var C=i.columnCount;if(o.isNoDataVisible(this)){o.focusItem(this,c+C*(s-n-1),e)}else if(n<s){if(f>0){o.focusItem(this,c+C*(s+f-n-1),e)}else{this._getScrollExtension().scrollVerticallyMax(true,true);o.focusItem(this,c+C*(s+l-u-n-1),e)}}else if(n>=s&&n<s+f){this._getScrollExtension().scrollVerticallyMax(true,true);o.focusItem(this,c+C*(s+l-u-n-1),e)}else if(n>=s+f&&n<s+l-u){this._getScrollExtension().scrollVerticallyMax(true,true);o.focusItem(this,c+C*(s+l-n-1),e)}else{o.focusItem(this,c+C*(s+l-n-1),e)}}}}};v.prototype.onsappageup=function(e){if(this._getKeyboardExtension().isInActionMode()){return}e.preventDefault();var t=o.getCellInfo(e.target);if(t.isOfType(r.ANYCONTENTCELL|r.COLUMNHEADER)){var i=o.getFocusedItemInfo(this);var n=i.row;var s=o.getHeaderRowCount(this);var l=this.getFixedRowCount();var a=this.getFixedBottomRowCount();if(l===0&&n>=s||l>0&&n>s){g(e);var f=i.cell;var u=i.columnCount;if(n<s+l){o.focusItem(this,f-u*(n-s),e)}else if(n===s+l){var c=o.getNonEmptyVisibleRowCount(this)-l-a;var v=this.getFirstVisibleRow();this._getScrollExtension().scrollVertically(false,true,true);if(v<c){if(l>0||t.isOfType(r.ROWACTION)){o.focusItem(this,f-u*(n-s),e)}else{o.focusItem(this,f-u*s,e)}}}else if(n>s+l&&n<s+o.getNonEmptyVisibleRowCount(this)){o.focusItem(this,f-u*(n-s-l),e)}else{o.focusItem(this,f-u*(n-s-o.getNonEmptyVisibleRowCount(this)+1),e)}}if(t.isOfType(r.ROWACTION)&&n===s&&l>0){g(e)}}};v.prototype.onsappagedown=function(e){if(this._getKeyboardExtension().isInActionMode()){return}e.preventDefault();var t=o.getCellInfo(e.target);if(t.isOfType(r.ANY)){var i=o.getFocusedItemInfo(this);var n=i.row;var s=o.getHeaderRowCount(this);var l=o.getNonEmptyVisibleRowCount(this);var a=this.getFixedRowCount();var f=this.getFixedBottomRowCount();g(e);if(o.isNoDataVisible(this)&&n<s-1||f===0||n<s+l-1){var u=i.cell;var c=i.columnCount;if(n<s-1&&!t.isOfType(r.COLUMNROWHEADER)){o.focusItem(this,u+c*(s-n-1),e)}else if(n<s){if(!o.isNoDataVisible(this)){o.focusItem(this,u+c*(s-n),e)}}else if(n>=s&&n<s+l-f-1){o.focusItem(this,u+c*(s+l-f-n-1),e)}else if(n===s+l-f-1){var v=o.getNonEmptyVisibleRowCount(this)-a-f;var C=this._getTotalRowCount()-f-this.getFirstVisibleRow()-v*2;this._getScrollExtension().scrollVertically(true,true,true);if(C<v&&f>0){o.focusItem(this,u+c*(s+l-n-1),e)}}else{o.focusItem(this,u+c*(s+l-n-1),e)}}}};v.prototype.onsappageupmodifiers=function(e){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(e,null,a.ALT)){var t=o.getCellInfo(e.target);var i=o.getFocusedItemInfo(this);if(t.isOfType(r.DATACELL|r.COLUMNHEADER)){var n=i.cell;var s=i.cellInRow;var l=o.hasRowHeader(this);var f=l?1:0;var c=u;g(e);if(l&&(o.Grouping.isInGroupingRow(e.target)||s===1)){o.focusItem(this,n-s,null)}else if(s-f<c){o.focusItem(this,n-s+f,null)}else{o.focusItem(this,n-c,null)}}else if(t.isOfType(r.ROWACTION)){o.focusItem(this,i.cell-1,null)}}};v.prototype.onsappagedownmodifiers=function(e){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(e,null,a.ALT)){var t=o.getCellInfo(e.target);if(t.isOfType(r.DATACELL|r.ROWHEADER|r.ANYCOLUMNHEADER)){var i=o.getFocusedItemInfo(this);var n=i.cellInRow;var s=o.hasRowHeader(this);var l=s?1:0;var f=o.getVisibleColumnCount(this);var c=parseInt(t.cell.attr("colspan")||1);g(e);if(n+c-l<f){var C=i.cell;var p=u;if(s&&n===0){o.focusItem(this,C+1,null)}else if(c>p){o.focusItem(this,C+c,null)}else if(n+c-l+p>f){o.focusItem(this,C+f-n-1+l,null)}else if(!o.Grouping.isInGroupingRow(e.target)){o.focusItem(this,C+p,null)}}else if(t.isOfType(r.DATACELL)&&o.hasRowActions(this)&&n===i.columnCount-2){o.focusItem(this,i.cell+1,null)}}}};v.prototype.onsapenter=function(e){v._handleSpaceAndEnter(this,e)};return v});