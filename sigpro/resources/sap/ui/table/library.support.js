/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/support/library","sap/ui/support/supportRules/RuleSet","./rules/TableHelper.support","sap/ui/Device","sap/ui/table/library","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/core/library"],function(e,t,i,a,o,n,s,r){"use strict";var l=e.Categories,c=e.Severity,u=o.VisibleRowCountMode;var p=r.MessageType;var g={name:"sap.ui.table",niceName:"UI5 Table library"};var h=new t(g);function d(e){e.id="gridTable"+e.id;i.addRuleToRuleset(e,h)}function f(e,t,a){var o=i.find(t,true,"sap.ui.table.Table");var n,s;for(var r=0;r<o.length;r++){n=o[r].getColumns();for(var l=0;l<n.length;l++){s=n[l].getTemplate();if(s&&s.isA(a)){e(o[r],n[l],s)}}}}d({id:"ContentDensity",categories:[l.Usage],title:"Content Density Usage",description:"Checks whether the content densities 'Cozy', 'Compact' and 'Condensed' are used correctly.",resolution:"Ensure that either only the 'Cozy' or 'Compact' content density is used or the 'Condensed' and 'Compact' content densities in combination are used.",resolutionurls:[i.createDocuRef("Documentation: Content Densities","#docs/guide/e54f729da8e3405fae5e4fe8ae7784c1.html")],check:function(e,t,a){var o=s("html");var n=o.find(".sapUiSizeCozy");var r=o.find(".sapUiSizeCompact");var l=o.find(".sapUiSizeCondensed");function u(t,a,o){var n=false;t.each(function(){if(s(this).closest(a).length){n=true}});if(n&&o){i.reportIssue(e,o,c.High)}return n}u(r,".sapUiSizeCozy","'Compact' content density is used within 'Cozy' area.");u(n,".sapUiSizeCompact","'Cozy' content density is used within 'Compact' area.");u(l,".sapUiSizeCozy","'Condensed' content density is used within 'Cozy' area.");u(n,".sapUiSizeCondensed","'Cozy' content density is used within 'Condensed' area.");if(l.length>0){var p=u(l,".sapUiSizeCompact");if(!p){i.reportIssue(e,"'Condensed' content density must be used in combination with 'Compact'.",c.High)}}if(sap.ui.getCore().getLoadedLibraries()["sap.m"]&&n.length===0&&r.length===0&&l.length===0){i.reportIssue(e,"If the sap.ui.table and the sap.m libraries are used together, a content density must be specified.",c.High)}}});d({id:"AccessibleLabel",categories:[l.Accessibility],title:"Accessible Label",description:"Checks whether 'sap.ui.table.Table' controls have an accessible label.",resolution:"Use the 'title' aggregation or the 'ariaLabelledBy' association of the 'sap.ui.table.Table' control to define a proper accessible labeling.",check:function(e,t,a){var o=i.find(a,true,"sap.ui.table.Table");for(var n=0;n<o.length;n++){if(!o[n].getTitle()&&o[n].getAriaLabelledBy().length==0){i.reportIssue(e,"Table '"+o[n].getId()+"' does not have an accessible label.",c.High,o[n].getId())}}}});d({id:"AccessibleRowHighlight",categories:[l.Accessibility],minversion:"1.62",title:"Accessible Row Highlight",description:"Checks whether the row highlights of the 'sap.ui.table.Table' controls are accessible.",resolution:"Use the 'highlightText' property of the 'sap.ui.table.RowSettings' to define the semantics of the row 'highlight'.",resolutionurls:[i.createDocuRef("API Reference: sap.ui.table.RowSettings#getHighlight","#/api/sap.ui.table.RowSettings/methods/getHighlight"),i.createDocuRef("API Reference: sap.ui.table.RowSettings#getHighlightText","#/api/sap.ui.table.RowSettings/methods/getHighlightText")],check:function(e,t,a){var o=i.find(a,true,"sap.ui.table.Table");function n(t){var a=t.getAggregation("_settings");var o=a?a.getHighlight():null;var n=a?a.getHighlightText():null;var s=t.getId();if(a&&!(o in p)&&n===""){i.reportIssue(e,"Row '"+s+"' of table '"+t.getParent().getId()+"' does not have a highlight text.",c.High,s)}}for(var s=0;s<o.length;s++){o[s].getRows().forEach(n)}}});d({id:"ColumnTemplateIcon",categories:[l.Accessibility],title:"Column template validation - 'sap.ui.core.Icon'",description:"The 'decorative' property of control 'sap.ui.core.Icon' is set to 'true' although the control is used as column template.",resolution:"Set the 'decorative' property of control 'sap.ui.core.Icon' to 'false' if the control is used as column template.",check:function(e,t,a){f(function(t,a,o){if(!o.isBound("decorative")&&o.getDecorative()){var n=a.getId();i.reportIssue(e,"Column '"+n+"' of table '"+t.getId()+"' uses decorative 'sap.ui.core.Icon' control.",c.High,n)}},a,"sap.ui.core.Icon")}});d({id:"ColumnTemplateTextWrapping",categories:[l.Usage],title:"Column template validation - 'sap.m.Text'",description:"The 'wrapping' and/or 'renderWhitespace' property of the control 'sap.m.Text' is set to 'true' although the control is used as a column template.",resolution:"Set the 'wrapping' and 'renderWhitespace' property of the control 'sap.m.Text' to 'false' if the control is used as a column template.",check:function(e,t,a){f(function(t,a,o){if(o.isBound("wrapping")||!o.isBound("wrapping")&&o.getWrapping()){var n=a.getId();i.reportIssue(e,"Column '"+n+"' of table '"+t.getId()+"' uses an 'sap.m.Text' control with wrapping enabled.",c.High,n)}if(o.isBound("renderWhitespace")||!o.isBound("renderWhitespace")&&o.getRenderWhitespace()){var n=a.getId();i.reportIssue(e,"Column '"+n+"' of table '"+t.getId()+"' uses an 'sap.m.Text' control with renderWhitespace enabled.",c.High,n)}},a,"sap.m.Text")}});d({id:"ColumnTemplateLinkWrapping",categories:[l.Usage],title:"Column template validation - 'sap.m.Link'",description:"The 'wrapping' property of the control 'sap.m.Link' is set to 'true' although the control is used as a column template.",resolution:"Set the 'wrapping' property of the control 'sap.m.Link' to 'false' if the control is used as a column template.",check:function(e,t,a){f(function(t,a,o){if(o.isBound("wrapping")||!o.isBound("wrapping")&&o.getWrapping()){var n=a.getId();i.reportIssue(e,"Column '"+n+"' of table '"+t.getId()+"' uses an 'sap.m.Link' control with wrapping enabled.",c.High,n)}},a,"sap.m.Link")}});d({id:"AnalyticsNoDeviatingUnits",categories:[l.Bindings],title:"Analytical Binding reports 'No deviating units found...'",description:"The analytical service returns duplicate IDs. This could also lead to many requests, but the analytical service expects to receive just one record",resolution:"Adjust the service implementation.",check:function(e,t,a){var o=i.find(a,true,"sap.ui.table.AnalyticalTable");var s="NO_DEVIATING_UNITS";var r={};i.checkLogEntries(function(e){if(e.level!=n.Level.ERROR&&e.level!=n.Level.FATAL){return false}var t=e.supportInfo;if(t&&t.type==="sap.ui.model.analytics.AnalyticalBinding"&&t.analyticalError===s){return true}return false},function(t){var a=t.supportInfo.analyticalBindingId;if(a&&!r[s+"-"+a]){var n;for(var l=0;l<o.length;l++){n=o[l].getBinding("rows");if(n&&n.__supportUID===a){r[s+"-"+a]=true;i.reportIssue(e,"Analytical Binding reports 'No deviating units found...'",c.High,o[l].getId())}}}})}});d({id:"RowHeights",categories:[l.Usage],title:"Row heights",description:"Checks whether the currently visible rows have the expected height.",resolution:"Check whether content densities are correctly used, and only the supported controls are used as column templates, with their"+' wrapping property set to "false"',resolutionurls:[i.createDocuRef("Documentation: Content Densities","#/topic/e54f729da8e3405fae5e4fe8ae7784c1"),i.createDocuRef("Documentation: Supported controls","#/topic/148892ff9aea4a18b912829791e38f3e"),i.createDocuRef("API Reference: sap.ui.table.Column#getTemplate","#/api/sap.ui.table.Column/methods/getTemplate"),{text:"SAP Fiori Design Guidelines: Grid Table",href:"https://experience.sap.com/fiori-design-web/grid-table/"}],check:function(e,t,o){var n=i.find(o,true,"sap.ui.table.Table");var s;var r;var l;var u;var p=a.browser.chrome&&window.devicePixelRatio!=1;var g=false;for(var h=0;h<n.length;h++){s=n[h].getRows();l=n[h]._getDefaultRowHeight();for(var d=0;d<s.length;d++){u=s[d].getDomRef();if(u){r=u.getBoundingClientRect().height;if(p){var f=Math.abs(l-r);if(f>1){g=true}}else if(r!==l){g=true}if(g){i.reportIssue(e,"The row height was expected to be "+l+"px, but was "+r+"px instead."+" This causes issues with vertical scrolling.",c.High,s[d].getId());break}}}}}});d({id:"DynamicPageConfiguration",categories:[l.Usage],title:"Table environment validation - 'sap.f.DynamicPage'",description:"Verifies that the DynamicPage is configured correctly from the table's perspective.",resolution:"If a table with visibleRowCountMode=Auto is placed inside a sap.f.DynamicPage, the fitContent property of the DynamicPage"+" should be set to true, otherwise false.",resolutionurls:[i.createDocuRef("API Reference: sap.f.DynamicPage#getFitContent","#/api/sap.f.DynamicPage/methods/getFitContent")],check:function(e,t,a){var o=i.find(a,true,"sap.ui.table.Table");function n(e,t){if(e){if(e.isA("sap.f.DynamicPage")){t(e)}n(e.getParent(),t)}}function s(t,a){if(t.getVisibleRowCountMode()===u.Auto&&!a.getFitContent()){i.reportIssue(e,'A table with visibleRowCountMode="Auto" is placed inside a sap.f.DynamicPage with fitContent="false"',c.High,t.getId())}else if(t.getVisibleRowCountMode()!==u.Auto&&a.getFitContent()){i.reportIssue(e,'A table with visibleRowCountMode="Fixed|Interactive" is placed inside a sap.f.DynamicPage with fitContent="true"',c.Low,t.getId())}}for(var r=0;r<o.length;r++){n(o[r],s.bind(null,o[r]))}}});return{lib:g,ruleset:h}},true);