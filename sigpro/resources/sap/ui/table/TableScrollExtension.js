/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableExtension","./TableUtils","sap/ui/Device","./library","sap/ui/performance/trace/Interaction","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,r,l,o,i,a){"use strict";var n=l.SharedDomRef;var s=1e6;var c=2;var u={HORIZONAL:"HORIZONTAL",VERTICAL:"VERTICAL",BOTH:"BOTH"};var d={SCROLLBAR:"Scrollbar",KEYBOARD:"Keyboard",MOUSEWHEEL:"MouseWheel",TOUCH:"Touch",FOCUS:"Focus",EXTENSION:"Extension",TABLE:"Table"};function f(e,t){i.debug("sap.ui.table.TableScrollExtension",e,t)}var v=new window.WeakMap;var g=function(e){if(!e){return{}}if(!v.has(e)){v.set(e,{oHorizontalScrollbar:null,iHorizontalScrollPosition:null,bVerticalScrollingSuspended:false,oVerticalScrollbar:null,oExternalVerticalScrollbar:null,nVerticalScrollPosition:null,iVerticalScrollHeight:null,iVerticalScrollbarHeight:null,iFirstVisibleRowInBuffer:null,bIsScrolledVerticallyByWheel:false,bIsScrolledVerticallyByKeyboard:false,mTouchSessionData:null,bIsVerticalScrollbarExternal:false,fnOnRowsUpdatedPreprocessor:null})}return v.get(e)};g.destroy=function(e){delete v.delete(e)};var S={onScroll:function(e){var t=e.target.scrollLeft;var r=e.target._scrollLeft;o.notifyScrollEvent&&o.notifyScrollEvent(e);if(t!==r){var l=S.getScrollAreas(this);e.target._scrollLeft=t;for(var i=0;i<l.length;i++){var a=l[i];if(a!==e.target&&a.scrollLeft!==t){a.scrollLeft=t;a._scrollLeft=t}}g(this).iHorizontalScrollPosition=t}},restoreScrollPosition:function(e){var t=e._getScrollExtension();var r=t.getHorizontalScrollbar();if(r&&g(e).iHorizontalScrollPosition!==null){var l=S.getScrollAreas(e);for(var o=0;o<l.length;o++){var i=l[o];delete i._scrollLeft}if(r.scrollLeft!==g(e).iHorizontalScrollPosition){r.scrollLeft=g(e).iHorizontalScrollPosition}else{var n=a.Event("scroll");n.target=r;S.onScroll.call(e,n)}}},onScrollbarMouseDown:function(e){this._getKeyboardExtension().setActionMode(false)},addEventListeners:function(e){var t=e._getScrollExtension();var r=t.getHorizontalScrollbar();var l=S.getScrollAreas(e);if(!t._onHorizontalScrollEventHandler){t._onHorizontalScrollEventHandler=S.onScroll.bind(e)}for(var o=0;o<l.length;o++){l[o].addEventListener("scroll",t._onHorizontalScrollEventHandler)}if(r){if(!t._onHorizontalScrollbarMouseDownEventHandler){t._onHorizontalScrollbarMouseDownEventHandler=S.onScrollbarMouseDown.bind(e)}r.addEventListener("mousedown",t._onHorizontalScrollbarMouseDownEventHandler)}},removeEventListeners:function(e){var t=e._getScrollExtension();var r=t.getHorizontalScrollbar();var l=S.getScrollAreas(e);if(t._onHorizontalScrollEventHandler){for(var o=0;o<l.length;o++){l[o].removeEventListener("scroll",t._onHorizontalScrollEventHandler);delete l[o]._scrollLeft}delete t._onHorizontalScrollEventHandler}if(r&&t._onHorizontalScrollbarMouseDownEventHandler){r.removeEventListener("mousedown",t._onHorizontalScrollbarMouseDownEventHandler);delete t._onHorizontalScrollbarMouseDownEventHandler}},getScrollAreas:function(e){var t=[e._getScrollExtension().getHorizontalScrollbar(),e.getDomRef("sapUiTableColHdrScr"),e.getDomRef("sapUiTableCtrlScr")];return t.filter(function(e){return e!=null})}};var h={updateScrollPosition:function(e,t,r,l){r=r==null?d.EXTENSION:r;var o=e._getScrollExtension();var i=o.getVerticalScrollbar();if(!e||!i||!o.isVerticalScrollbarRequired()||g(e).bVerticalScrollingSuspended){f("VerticalScrollingHelper#updateScrollPosition: Not executed - Guard clause not passed",e);return}var a=g(e).nVerticalScrollPosition;var n=h.getScrollRange(e);if(t==null){var s=e.getFirstVisibleRow();var c=e._getMaxFirstRenderedRowIndex();if(s>c){t=n;g(e).iFirstVisibleRowInBuffer=s-c}else{t=s*h.getScrollRangeRowFraction(e);g(e).iFirstVisibleRowInBuffer=null}}else{g(e).iFirstVisibleRowInBuffer=null}g(e).nVerticalScrollPosition=Math.min(Math.max(0,t),n);f("VerticalScrollingHelper#updateScrollPosition: From "+a+" to "+g(e).nVerticalScrollPosition+" (diff: "+(g(e).nVerticalScrollPosition-a)+", trigger: "+r+")",e);if(l===true){f("VerticalScrollingHelper#updateScrollPosition: Scrolling prevented",e);return}window.cancelAnimationFrame(e._mAnimationFrames.verticalScrollUpdate);delete e._mAnimationFrames.verticalScrollUpdate;switch(r){case d.SCROLLBAR:clearTimeout(e._mTimeouts.largeDataScrolling);delete e._mTimeouts.largeDataScrolling;if(e._bLargeDataScrolling&&!g(e).bIsScrolledVerticallyByWheel){e._mTimeouts.largeDataScrolling=setTimeout(function(){delete e._mTimeouts.largeDataScrolling;h.updateFirstVisibleRow(e)},300)}else{h.updateFirstVisibleRow(e)}break;case d.KEYBOARD:case d.MOUSEWHEEL:case d.TOUCH:case d.EXTENSION:case d.TABLE:var u=0;var v=h.getScrollRange(e);if(g(e).nVerticalScrollPosition>0&&g(e).nVerticalScrollPosition<.5){u=1}else if(g(e).nVerticalScrollPosition>=v-.5&&g(e).nVerticalScrollPosition<v){u=v-1}else{u=Math.round(g(e).nVerticalScrollPosition)}if(i.scrollTop!==u){f("VerticalScrollingHelper#updateScrollPosition: scrollTop will be set asynchronously",e);e._mAnimationFrames.verticalScrollUpdate=window.requestAnimationFrame(function(){var t=i.scrollTop;delete e._mAnimationFrames.verticalScrollUpdate;f("VerticalScrollingHelper#updateScrollPosition: (async) Set scrollTop from "+t+" to "+u,e);i.scrollTop=u;i._scrollTop=i.scrollTop;if(u===v&&u!==i.scrollTop){f("VerticalScrollingHelper#updateScrollPosition: (async) Adjusted from "+g(e).nVerticalScrollPosition+" to "+i.scrollTop,e);g(e).nVerticalScrollPosition=i.scrollTop}h.updateFirstVisibleRow(e)})}else if(g(e).nVerticalScrollPosition!==a){f("VerticalScrollingHelper#updateScrollPosition: firstVisibleRow will be set asynchronously",e);e._mAnimationFrames.verticalScrollUpdate=window.requestAnimationFrame(function(){delete e._mAnimationFrames.verticalScrollUpdate;h.updateFirstVisibleRow(e)})}else{f("VerticalScrollingHelper#updateScrollPosition: scrollTop and nVerticalScrollPosition not changed"+" -> update inner vertical scroll position",e);o.updateInnerVerticalScrollPosition()}break;default:}},onScroll:function(e){o.notifyScrollEvent&&o.notifyScrollEvent(e);if(g(this).bIsScrolledVerticallyByKeyboard){f("Vertical scroll event handler: Aborted - Scrolled by keyboard",this);return}this._getKeyboardExtension().setActionMode(false);var t=e.target.scrollTop;var r=e.target._scrollTop;var l=t!==r;if(l){f("Vertical scroll event handler: Scroll position changed by scrolling with the scrollbar:"+" From "+g(this).nVerticalScrollPosition+" to "+t,this);delete e.target._scrollTop;h.updateScrollPosition(this,t,d.SCROLLBAR)}else{f("Vertical scroll event handler: Scroll position changed by scrolling with VerticalScrollingHelper#updateScrollPosition",this)}g(this).bIsScrolledVerticallyByWheel=false},updateFirstVisibleRow:function(e){var r=e._getScrollExtension();var l=e._getMaxFirstRenderedRowIndex();var o=h.getRowIndexAtCurrentScrollPosition(e);var i=e.getFirstVisibleRow();var a=o<0;var n=i>=l;var s=o!==i;var c=s&&!(a&&n);if(c){var u=!n||o!==l;if(a){o=l}f("updateFirstVisibleRow: From "+i+" to "+o,e);e.setFirstVisibleRow(o,true,a);if(u){h.setOnRowsUpdatedPreprocessor(e,function(e){f("updateFirstVisibleRow - onRowsUpdatedPreprocessor: Reason "+e.getParameters().reason,this);r.updateInnerVerticalScrollPosition();if(a){var t=this.getFirstVisibleRow();var l=o===t;if(l){this.setProperty("firstVisibleRow",-1,true);this.setFirstVisibleRow(t,true)}}return false})}else{f("updateFirstVisibleRow: Update inner vertical scroll position",e);r.updateInnerVerticalScrollPosition()}}else if(t.isVariableRowHeightEnabled(e)){f("updateFirstVisibleRow: Update inner vertical scroll position",e);r.updateInnerVerticalScrollPosition()}},getRowIndexAtCurrentScrollPosition:function(e){var r=e._getScrollExtension();var l=e._getMaxFirstVisibleRowIndex();if(l===0){return 0}else{var o=h.getScrollPosition(e);var i=h.getScrollRange(e);var a=h.getScrollRangeRowFraction(e);if(t.isVariableRowHeightEnabled(e)){if(h.isScrollPositionInBuffer(e)){return-1}else{return Math.min(l,Math.floor(o/a))}}else{var n=Math.floor(o/a);var s=i-o;var c=r.getVerticalScrollbar()._scrollTop==null||g(e).bIsScrolledVerticallyByWheel;var u=s<1&&c||s<.01;if(u){h.updateScrollPosition(e,i,null,true)}return u?l:Math.min(l,n)}}},getScrollRange:function(e){var t=e._getScrollExtension();var r=t.getVerticalScrollHeight()-t.getVerticalScrollbarHeight();return Math.max(0,r)},getScrollRangeBuffer:function(e){if(!t.isVariableRowHeightEnabled(e)){return 0}return c*e._getDefaultRowHeight()},getScrollPosition:function(e){var t=e._getScrollExtension();if(g(e).nVerticalScrollPosition!=null){return g(e).nVerticalScrollPosition}else if(t.isVerticalScrollbarVisible()){return t.getVerticalScrollbar().scrollTop}else{return 0}},getScrollRangeRowFraction:function(e){var r=e._getScrollExtension();var l=e._getTotalRowCount()-e.getVisibleRowCount();var o;if(t.isVariableRowHeightEnabled(e)){o=h.getScrollRange(e)-h.getScrollRangeBuffer(e);var i=r.getVerticalScrollHeight()===s;if(!i){o+=e._getDefaultRowHeight()}}else{o=h.getScrollRange(e)}return o/Math.max(1,l)},isScrollPositionInBuffer:function(e){if(!t.isVariableRowHeightEnabled(e)){return false}var r=h.getScrollRange(e);var l=h.getScrollPosition(e);var o=h.getScrollRangeBuffer(e);return r-l<=o},getInnerScrollRange:function(e){if(!e||!e._aRowHeights){return 0}var t=e._aRowHeights;var r=e._getDefaultRowHeight()*e.getVisibleRowCount();if(e.getVisibleRowCount()>=e._getTotalRowCount()){t=t.slice(0,e._getTotalRowCount())}var l=t.reduce(function(e,t){return e+t},0)-r;if(l>0){l=Math.ceil(l)}return Math.max(0,l)},onScrollbarMouseDown:function(e){g(this).bIsScrolledVerticallyByWheel=false;g(this).bIsScrolledVerticallyByKeyboard=false},setOnRowsUpdatedPreprocessor:function(e,t){g(e).fnOnRowsUpdatedPreprocessor=t},runOnRowsUpdatedPreprocessor:function(e,t){var r=true;if(g(e).fnOnRowsUpdatedPreprocessor!=null){r=g(e).fnOnRowsUpdatedPreprocessor.call(e,t)!==false}g(e).fnOnRowsUpdatedPreprocessor=null;return r},onRowsUpdated:function(e){var r=this._getScrollExtension();var l=h.runOnRowsUpdatedPreprocessor(this,e);if(!t.isVariableRowHeightEnabled(this)||!l){return}var o=e.getParameters().reason;var i=o===t.RowsUpdateReason.Expand||o===t.RowsUpdateReason.Collapse;var a=this.getFirstVisibleRow()-this._getMaxFirstRenderedRowIndex();f("onRowsUpdated: Reason "+o,this);if(a>=0&&i){g(this).iFirstVisibleRowInBuffer=a;r.updateInnerVerticalScrollPosition()}},restoreScrollPosition:function(e){h.updateScrollPosition(e,g(e).nVerticalScrollPosition)},addEventListeners:function(e){var t=e._getScrollExtension();var r=h.getScrollAreas(e);var l=t.getVerticalScrollbar();if(!t._onVerticalScrollEventHandler){t._onVerticalScrollEventHandler=h.onScroll.bind(e)}for(var o=0;o<r.length;o++){r[o].addEventListener("scroll",t._onVerticalScrollEventHandler)}if(l){if(!t._onVerticalScrollbarMouseDownEventHandler){t._onVerticalScrollbarMouseDownEventHandler=h.onScrollbarMouseDown.bind(e)}l.addEventListener("mousedown",t._onVerticalScrollbarMouseDownEventHandler)}e.attachEvent("_rowsUpdated",h.onRowsUpdated)},removeEventListeners:function(e){var t=e._getScrollExtension();var r=h.getScrollAreas(e);var l=t.getVerticalScrollbar();if(t._onVerticalScrollEventHandler){for(var o=0;o<r.length;o++){r[o].removeEventListener("scroll",t._onVerticalScrollEventHandler)}delete t._onVerticalScrollEventHandler}if(l&&t._onVerticalScrollbarMouseDownEventHandler){l.removeEventListener("mousedown",t._onVerticalScrollbarMouseDownEventHandler);delete t._onVerticalScrollbarMouseDownEventHandler}e.detachEvent("_rowsUpdated",h.onRowsUpdated)},isUpdatePending:function(e){return!!(e&&e._mAnimationFrames.verticalScrollUpdate)},getScrollAreas:function(e){var t=[e._getScrollExtension().getVerticalScrollbar()];return t.filter(function(e){return e!=null})}};var b={onMouseWheelScrolling:function(e,r){var l=this._getScrollExtension();var o=Math.abs(r.deltaY)>Math.abs(r.deltaX);var i=o?r.deltaY:r.deltaX;var a=o&&r.shiftKey||!o;var n=i>0;var s=false;if(i===0){return}if(a&&(e.scrollDirection===u.HORIZONAL||e.scrollDirection===u.BOTH)){var c=l.getHorizontalScrollbar();if(r.deltaMode>0){var f=t.Column.getMinColumnWidth();i=n?f:-f}if(n){s=c.scrollLeft===c.scrollWidth-c.offsetWidth}else{s=c.scrollLeft===0}if(l.isHorizontalScrollbarVisible()&&!s){r.preventDefault();r.stopPropagation();this._getKeyboardExtension().setActionMode(false);c.scrollLeft=c.scrollLeft+i}}else if(!a&&(e.scrollDirection===u.VERTICAL||e.scrollDirection===u.BOTH)){var v=l.getVerticalScrollbar();var S=this._getMaxFirstRenderedRowIndex();var b=this._getFirstRenderedRowIndex()===S;var p=h.getScrollRangeRowFraction(this);var V=b?this._getDefaultRowHeight():p;if(r.deltaMode===1){i*=V}else if(r.deltaMode===2){i*=V*this.getVisibleRowCount()}if(n){s=v.scrollTop===v.scrollHeight-v.offsetHeight}else{s=v.scrollTop===0}if(l.isVerticalScrollbarVisible()&&!s){r.preventDefault();r.stopPropagation();var R=h.getScrollPosition(this);var E=R-S*p;var w=i;if(!b||b&&E===0&&!n){var T=i/(r.deltaMode===0?this._getDefaultRowHeight():p);if(T>1){T=Math.floor(T)}else if(T<-1){T=Math.ceil(T)}w=T*p}else if(!n){if(E+w<0){w=-E}}g(this).bIsScrolledVerticallyByWheel=true;g(this).bIsScrolledVerticallyByKeyboard=false;h.updateScrollPosition(this,R+w,d.MOUSEWHEEL)}}},onTouchStart:function(e,t){if(t.type==="touchstart"||t.pointerType==="touch"){var r=this._getScrollExtension();var l=r.getHorizontalScrollbar();var o=r.getVerticalScrollbar();var i=t.touches?t.touches[0]:t;g(this).mTouchSessionData={initialPageX:i.pageX,initialPageY:i.pageY,initialScrollTop:o?o.scrollTop:0,initialScrollLeft:l?l.scrollLeft:0,initialScrolledToEnd:null,touchMoveDirection:null}}},onTouchMoveScrolling:function(e,t){if(t.type!=="touchmove"&&t.pointerType!=="touch"){return}var r=this._getScrollExtension();var l=g(this).mTouchSessionData;if(!l){return}var o=t.touches?t.touches[0]:t;var i=o.pageX-l.initialPageX;var a=o.pageY-l.initialPageY;var n=false;if(!l.touchMoveDirection){if(i===0&&a===0){return}l.touchMoveDirection=Math.abs(i)>Math.abs(a)?"horizontal":"vertical"}switch(l.touchMoveDirection){case"horizontal":var s=r.getHorizontalScrollbar();if(s&&(e.scrollDirection===u.HORIZONAL||e.scrollDirection===u.BOTH)){this._getKeyboardExtension().setActionMode(false);if(l.initialScrolledToEnd==null){if(i<0){l.initialScrolledToEnd=s.scrollLeft===s.scrollWidth-s.offsetWidth}else{l.initialScrolledToEnd=s.scrollLeft===0}}if(!l.initialScrolledToEnd){s.scrollLeft=l.initialScrollLeft-i;n=true}}break;case"vertical":var c=r.getVerticalScrollbar();if(c&&(e.scrollDirection===u.VERTICAL||e.scrollDirection===u.BOTH)){if(l.initialScrolledToEnd==null){if(a<0){l.initialScrolledToEnd=c.scrollTop===c.scrollHeight-c.offsetHeight}else{l.initialScrolledToEnd=c.scrollTop===0}}if(!l.initialScrolledToEnd){h.updateScrollPosition(this,l.initialScrollTop-a,d.TOUCH);n=true}}break;default:}if(n){t.preventDefault()}},addEventListeners:function(e){var t=e._getScrollExtension();var r=b.getEventListenerTargets(e);t._mMouseWheelEventListener=this.addMouseWheelEventListener(r,e,{scrollDirection:u.BOTH});t._mTouchEventListener=this.addTouchEventListener(r,e,{scrollDirection:u.BOTH})},addMouseWheelEventListener:function(e,t,r){var l=b.onMouseWheelScrolling.bind(t,r);for(var o=0;o<e.length;o++){e[o].addEventListener("wheel",l)}return{wheel:l}},addTouchEventListener:function(e,t,l){var o=b.onTouchStart.bind(t,l);var i=b.onTouchMoveScrolling.bind(t,l);var a={};for(var n=0;n<e.length;n++){if(r.support.pointer&&r.system.desktop){e[n].addEventListener("pointerdown",o);e[n].addEventListener("pointermove",i,r.browser.chrome?{passive:true}:false)}else if(r.support.touch){e[n].addEventListener("touchstart",o);e[n].addEventListener("touchmove",i)}}if(r.support.pointer&&r.system.desktop){a={pointerdown:o,pointermove:i}}else if(r.support.touch){a={touchstart:o,touchmove:i}}return a},removeEventListeners:function(e){var t=e._getScrollExtension();var r=b.getEventListenerTargets(e);function l(e,t){for(var r in t){var l=t[r];if(l){e.removeEventListener(r,l)}}}for(var o=0;o<r.length;o++){l(r[o],t._mMouseWheelEventListener);l(r[o],t._mTouchEventListener)}delete t._mMouseWheelEventListener;delete t._mTouchEventListener},getEventListenerTargets:function(e){var t=[e.getDomRef("tableCCnt")];return t.filter(function(e){return e!=null})}};var p={onBeforeRendering:function(e){var t=this._getScrollExtension();var r=e!=null&&e.isMarked("renderRows");t._clearCache();if(!r){g(this).bVerticalScrollingSuspended=true;this.attachEventOnce("_rowsUpdated",function(){g(this).bVerticalScrollingSuspended=false;h.restoreScrollPosition(this)})}},onAfterRendering:function(e){var t=this._getScrollExtension();var r=e!=null&&e.isMarked("renderRows");if(r){t.updateVerticalScrollbarHeight();t.updateVerticalScrollHeight()}S.restoreScrollPosition(this)},onfocusin:function(e){var r;var l=t.getCellInfo(e.target);if(l.isOfType(t.CELLTYPE.DATACELL)){r=this.getDomRef("sapUiTableCtrlScr")}else if(l.isOfType(t.CELLTYPE.COLUMNHEADER)){r=this.getDomRef("sapUiTableColHdrScr")}if(r&&l.columnIndex>=this.getComputedFixedColumnCount()){var o=this._getScrollExtension().getHorizontalScrollbar();var i=a(o);var n=l.cell[0];var s=this._bRtlMode?i.scrollLeftRTL():o.scrollLeft;var c=r.clientWidth;var u=n.offsetLeft;var d=u+n.offsetWidth;var f=u-s;var v=d-c-s;var g;if(f<0&&v<0){g=s+f}else if(v>0&&f>0){g=s+v}if(g!=null){if(this._bRtlMode){i.scrollLeftRTL(g)}else{o.scrollLeft=g}}}var S=t.getParentCell(this,e.target);if(S){Promise.resolve().then(function(){var e=S.find(".sapUiTableCell");if(e.length>0){if(this._bRtlMode){e.scrollLeftRTL(e[0].scrollWidth-e[0].clientWidth)}else{e[0].scrollLeft=0}e[0].scrollTop=0}}.bind(this))}}};var V=e.extend("sap.ui.table.TableScrollExtension",{_init:function(e,t,r){this._delegate=p;e.addEventDelegate(this._delegate,e);return"ScrollExtension"},_attachEvents:function(){var e=this.getTable();S.addEventListeners(e);h.addEventListeners(e);b.addEventListeners(e)},_detachEvents:function(){var e=this.getTable();S.removeEventListeners(e);h.removeEventListeners(e);b.removeEventListeners(e)},_debug:function(){this._ScrollingHelper=b;this._ExtensionDelegate=p;this._HorizontalScrollingHelper=S;this._VerticalScrollingHelper=h},destroy:function(){var t=this.getTable();if(t){t.removeEventDelegate(this._delegate)}this._delegate=null;this._clearCache();g.destroy(t);e.prototype.destroy.apply(this,arguments)}});V.prototype.scrollVertically=function(e,t,r,l,o){var i=this.getTable();if(!i){return false}e=e===true;t=t===true;r=r===true;l=l===true;var a=false;var n=i._getTotalRowCount();var s=i.getVisibleRowCount();var c=s-i.getFixedRowCount()-i.getFixedBottomRowCount();var u=i.getFirstVisibleRow();var d=t?c:1;if(e){if(u+s<n){if(o){o()}if(l){setTimeout(function(){i.setFirstVisibleRow(Math.min(u+d,n-s))},0)}else{i.setFirstVisibleRow(Math.min(u+d,n-s))}a=true}}else if(u>0){if(o){o()}if(l){setTimeout(function(){i.setFirstVisibleRow(Math.max(u-d,0))},0)}else{i.setFirstVisibleRow(Math.max(u-d,0))}a=true}if(a&&r){g(i).bIsScrolledVerticallyByKeyboard=true}return a};V.prototype.scrollVerticallyMax=function(e,r){var l=this.getTable();if(!l){return false}if(e==null){e=false}if(r==null){r=false}var o=false;var i=l.getFirstVisibleRow();if(e){var a=l._getTotalRowCount()-t.getNonEmptyVisibleRowCount(l);if(i<a){l.setFirstVisibleRow(a);o=true}}else if(i>0){l.setFirstVisibleRow(0);o=true}if(o&&r){g(l).bIsScrolledVerticallyByKeyboard=true}return o};V.prototype.getHorizontalScrollbar=function(){var e=this.getTable();if(e&&!e._bInvalid&&!g(e).oHorizontalScrollbar){g(e).oHorizontalScrollbar=e.getDomRef(n.HorizontalScrollBar)}return g(e).oHorizontalScrollbar||null};V.prototype.getVerticalScrollbar=function(){var e=this.getTable();if(e&&!e._bInvalid&&!g(e).oVerticalScrollbar){g(e).oVerticalScrollbar=e.getDomRef(n.VerticalScrollBar);if(!g(e).oVerticalScrollbar&&this.isVerticalScrollbarExternal()){g(e).oVerticalScrollbar=g(e).oExternalVerticalScrollbar}}return g(e).oVerticalScrollbar||null};V.prototype.isHorizontalScrollbarVisible=function(){var e=this.getHorizontalScrollbar();return e!=null&&!e.classList.contains("sapUiTableHidden")};V.prototype.isVerticalScrollbarVisible=function(){var e=this.getVerticalScrollbar();return e!=null&&!e.classList.contains("sapUiTableHidden")};V.prototype.isVerticalScrollbarExternal=function(){return g(this.getTable()).bIsVerticalScrollbarExternal};V.prototype.markVerticalScrollbarAsExternal=function(e){if(e){g(this.getTable()).bIsVerticalScrollbarExternal=true;g(this.getTable()).oExternalVerticalScrollbar=e}};V.prototype.updateHorizontalScrollbar=function(e){var t=this.getTable();var l=this.getHorizontalScrollbar();if(!t||!l||!e){return}var o=t.$();var i=e.tableCtrlScrollWidth;if(r.browser.safari){i=Math.max(i,t._getColumnsWidth(t.getComputedFixedColumnCount()))}var a=i>e.tableCtrlScrWidth;if(a){if(!this.isHorizontalScrollbarVisible()){o.addClass("sapUiTableHScr");l.classList.remove("sapUiTableHidden");if(r.browser.safari){var n=o.find(".sapUiTableCtrlScroll, .sapUiTableColHdrScr > .sapUiTableColHdr");n.outerWidth(i)}}var s=e.tableCtrlFixedWidth;if(o.find(".sapUiTableRowHdrScr").length>0){s+=e.tableRowHdrScrWidth}if(t._bRtlMode){l.style.marginRight=s+"px";l.style.marginLeft=""}else{l.style.marginLeft=s+"px";l.style.marginRight=""}var c=t.getDomRef("hsb-content");if(c){c.style.width=i+"px"}}if(!a&&this.isHorizontalScrollbarVisible()){o.removeClass("sapUiTableHScr");l.classList.add("sapUiTableHidden");if(r.browser.safari){o.find(".sapUiTableCtrlScroll, .sapUiTableColHdr").css("width","")}}};V.prototype.updateVerticalScrollbarHeight=function(){var e=this.getTable();var t=this.getVerticalScrollbar();if(!e||!t){return}var r=this.getVerticalScrollbarHeight();t.style.maxHeight=r+"px";if(g(e).iVerticalScrollbarHeight!==r){g(e).iVerticalScrollbarHeight=r;h.updateScrollPosition(e)}};V.prototype.getVerticalScrollbarHeight=function(){var e=this.getTable();if(!e){return 0}var t=Math.max(1,e.getVisibleRowCount()-e.getFixedRowCount()-e.getFixedBottomRowCount());return t*e._getDefaultRowHeight()};V.prototype.updateVerticalScrollbarPosition=function(){var e=this.getTable();var t=this.getVerticalScrollbar();if(!e||!t){return}var r=e.getDomRef("tableCCnt");if(r){var l=r.offsetTop;var o=e.getDomRef("vsb-bg");if(o){o.style.top=l+"px"}var i=e.getFixedRowCount();if(i>0){l+=e._iVsbTop}t.style.top=l+"px"}};V.prototype.updateVerticalScrollPosition=function(){h.updateScrollPosition(this.getTable(),undefined,d.TABLE)};V.prototype.restoreVerticalScrollPosition=function(){h.restoreScrollPosition(this.getTable())};V.prototype.updateVerticalScrollHeight=function(){var e=this.getVerticalScrollbar();var t=e?e.firstChild:null;if(!t){return}var r=this.getVerticalScrollHeight(true);t.style.height=this.getVerticalScrollHeight()+"px";if(g(this.getTable()).iVerticalScrollHeight!==r){g(this.getTable()).iVerticalScrollHeight=r;h.updateScrollPosition(this.getTable())}};V.prototype.getVerticalScrollHeight=function(e){var r=this.getTable();if(!r){return 0}var l=r._getTotalRowCount();var o=r.getVisibleRowCount();var i=r._getDefaultRowHeight();var a;var n;if(t.isVariableRowHeightEnabled(r)){a=Math.max(l,o+1);n=i*(a-1)+h.getScrollRangeBuffer(r)}else{a=Math.max(l,o);n=i*a}if(e===true){return n}else{return Math.min(s,n)}};V.prototype.updateVerticalScrollbarVisibility=function(){var e=this.getTable();var t=e?e.getDomRef():null;var r=this.getVerticalScrollbar();if(!t||!r){return}var l=this.isVerticalScrollbarRequired();if(l&&!this.isVerticalScrollbarVisible()){if(!this.isVerticalScrollbarExternal()){t.classList.add("sapUiTableVScr")}r.classList.remove("sapUiTableHidden")}if(!l&&this.isVerticalScrollbarVisible()){t.classList.remove("sapUiTableVScr");r.classList.add("sapUiTableHidden")}};V.prototype.isVerticalScrollbarRequired=function(){var e=this.getTable();if(!e){return false}return h.getInnerScrollRange(e)>0||e._getTotalRowCount()>e.getVisibleRowCount()};V.prototype.updateInnerVerticalScrollPosition=function(){var e=this.getTable();var r=e?e.getDomRef("tableCCnt"):null;if(!t.isVariableRowHeightEnabled(e)||!r||h.isUpdatePending(e)){return}if(e._getFirstRenderedRowIndex()!==e._iRenderedFirstVisibleRow){f("updateInnerVerticalScrollPosition: Skipped, because rows will be updated",e);return}var l=h.getInnerScrollRange(e);if(l===0){f("updateInnerVerticalScrollPosition: 0",e);e.setFirstVisibleRow(0,true);this._nVerticalScrollPosition=0;r.scrollTop=0;return}var o=e.getFirstVisibleRow();var i=h.getScrollPosition(e);var a=h.isScrollPositionInBuffer(e);var n=0;var s;var c;var u=null;var d=e._aRowHeights;if(!a){var v=h.getScrollRangeRowFraction(e);n=i-o*v;s=d[0];c=Math.max(0,Math.min(n/v,1));u=Math.round(s*c)}else{var S=0;var b=0;var p;for(p=0;p<d.length&&b<l;p++){S++;b+=d[p]}var V=h.getScrollRange(e);var R=h.getScrollRangeBuffer(e);var E=R/S;if(g(e).iFirstVisibleRowInBuffer==null){n=i-V+R;var w=n/E;var T;if(Math.ceil(w)-w<1e-5){T=Math.ceil(n/E)}else{T=Math.floor(n/E)}T=Math.min(T,S);s=d[T]||0;c=Math.max(0,Math.min((n-E*T)/E,1));for(p=0;p<T;p++){u+=d[p]}u+=s*c;u=Math.min(u,l);var H=e._getMaxFirstRenderedRowIndex()+T;if(H!==o){f("updateInnerVerticalScrollPosition: Set firstVisibleRow from "+o+" to "+H,e);e.setFirstVisibleRow(H,true)}}else{var m=V-R;n=g(e).iFirstVisibleRowInBuffer*E;var _=m+n;c=0;f("updateInnerVerticalScrollPosition: Set scroll position to "+_,e);h.updateScrollPosition(e,_);return}}f("updateInnerVerticalScrollPosition: "+u+" of "+s+" ("+c*100+"%)"+" (in buffer: "+a+")",e);r.scrollTop=u};V.prototype.registerForMouseWheel=function(t,r){var l=this.getTable();if(e.isEnrichedWith(l,"sap.ui.table.TableSyncExtension")){return b.addMouseWheelEventListener(t,l,r)}else{i.error("This method can only be used with synchronization enabled.",l,"TableScrollExtension#registerForMouseWheel");return null}};V.prototype.registerForTouch=function(t,r){var l=this.getTable();if(e.isEnrichedWith(l,"sap.ui.table.TableSyncExtension")){return b.addTouchEventListener(t,l,r)}else{i.error("This method can only be used with synchronization enabled.",l,"TableScrollExtension#registerForTouch");return null}};V.prototype._clearCache=function(){g(this.getTable()).oVerticalScrollbar=null;g(this.getTable()).oHorizontalScrollbar=null};V.ScrollDirection=u;return V});