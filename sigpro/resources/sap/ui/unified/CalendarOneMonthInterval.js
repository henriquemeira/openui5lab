/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","./library","sap/ui/unified/CalendarDateInterval","sap/ui/unified/CalendarDateIntervalRenderer","sap/ui/unified/calendar/OneMonthDatesRow","sap/ui/core/Renderer","sap/ui/unified/Calendar","sap/ui/unified/CalendarRenderer","./CalendarOneMonthIntervalRenderer","sap/ui/dom/containsOrEquals"],function(t,e,a,n,o,i,s,r,h,c,u){"use strict";var d=n.extend("sap.ui.unified.CalendarOneMonthInterval",{});d.prototype.init=function(){n.prototype.init.apply(this,arguments);this._bShowOneMonth=true};d.prototype._getCalendarPicker=function(){var e=this.getAggregation("calendarPicker");if(!e){e=new g(this.getId()+"--Cal");e.setPopupMode(true);e.attachEvent("select",function(){var e=this._getCalendarPicker(),a=e._getFocusedDate(),n=t._getFirstDateOfMonth(a);this._setStartDate(n);this._adjustSelectedDate(n,false);this._oFocusDateOneMonth=n;this._closeCalendarPicker(true);this._focusDate(a,false,true)},this);e.attachEvent("cancel",function(t){var e=this._getCalendarPicker(),a=e._getFocusedDate();this._closeCalendarPicker(true);this._oFocusDateOneMonth=a;this._focusDate(a,true);var n=this.getAggregation("header").getDomRef("B1");if(n){n.focus()}},this);this.setAggregation("calendarPicker",e)}return e};d.prototype._createMonth=function(t){return new i(t)};d.prototype._handleFocus=function(a){var o=!!a.getParameter("_outsideBorder"),i=a.getParameter("date"),s=e.fromLocalJSDate(i),r=e.fromLocalJSDate(this.getStartDate()),h=!t._isSameMonthAndYear(s,r),c,u,d;if(o||h){if(t._isLastDateInMonth(s)){this._oFocusDateOneMonth=s}else{this._oFocusDateOneMonth=t._getFirstDateOfMonth(s)}c=s.isBefore(r)?-1:1;u=new e(this._getFocusedDate(),this.getPrimaryCalendarType());d=new e(this._getStartDate(),this.getPrimaryCalendarType());n.prototype._shiftStartFocusDates.call(this,u,d,c)}return n.prototype._handleFocus.apply(this,arguments)};d.prototype._focusDateExtend=function(t,e,a){var o,i;if(!this._oFocusDateOneMonth){return n.prototype._focusDateExtend.apply(this,arguments)}o=this.getAggregation("month")[0];i=this._oFocusDateOneMonth.toLocalJSDate();this._setFocusedDate(this._oFocusDateOneMonth);o._bNoRangeCheck=true;o.setDate(i);o._bNoRangeCheck=false;this._oFocusDateOneMonth=null;return!a};d.prototype._setDisplayMode=function(t){this.getAggregation("month")[0].setMode(t)};d.prototype._shiftStartFocusDates=function(t,e,a){var n=a,o=this.getAggregation("month")[0];if(n!==0){n=n>0?1:-1}t.setMonth(t.getMonth()+n);e.setYear(t.getYear());e.setMonth(t.getMonth());e.setDate(t.getDate());this._setFocusedDate(e);this._setStartDate(t,true);o.selectDate(t.toLocalJSDate())};d.prototype._adjustSelectedDate=function(e,a){var n=this.getAggregation("month")[0],o;o=a?t._getFirstDateOfMonth(e):e;if(n.getMode&&n.getMode()<2){this._selectDate(o)}};d.prototype._selectDate=function(t){var e=this.getAggregation("month")[0],a=t.toLocalJSDate();this.removeAllSelectedDates();this.addSelectedDate(new sap.ui.unified.DateRange({startDate:a}));e.selectDate(a);this._bDateRangeChanged=undefined};d.prototype._dateMatchesVisibleRange=function(a){return t._isSameMonthAndYear(e.fromLocalJSDate(this.getStartDate()),e.fromLocalJSDate(a))};var g=r.extend("CustomMonthPicker",{renderer:s.extend(h)});g.prototype._initializeHeader=function(){var t=new sap.ui.unified.calendar.Header(this.getId()+"--Head",{visibleButton1:false});t.attachEvent("pressPrevious",this._handlePrevious,this);t.attachEvent("pressNext",this._handleNext,this);t.attachEvent("pressButton2",this._handleButton2,this);this.setAggregation("header",t)};g.prototype._shouldFocusB2OnTabNext=function(t){return u(this.getDomRef("content"),t.target)};g.prototype.onAfterRendering=function(){this._showMonthPicker()};g.prototype._selectYear=function(){var t=this.getAggregation("yearPicker");var e=this._getFocusedDate();e.setYear(t.getYear());this._focusDate(e,true);this._showMonthPicker()};g.prototype._selectMonth=function(){var t=this.getAggregation("monthPicker");var e=this.getSelectedDates()[0];var a=this._getFocusedDate();a.setMonth(t.getMonth());if(!e){e=new sap.ui.unified.DateRange}e.setStartDate(a.toLocalJSDate());this.addSelectedDate(e);this.fireSelect()};g.prototype.onsapescape=function(t){this.fireCancel()};return d});