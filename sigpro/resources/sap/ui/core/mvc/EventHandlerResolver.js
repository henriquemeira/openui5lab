/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/base/BindingParser","sap/ui/core/Element","sap/ui/model/BindingMode","sap/ui/model/CompositeBinding","sap/ui/model/json/JSONModel","sap/ui/model/base/ManagedObjectModel","sap/base/util/ObjectPath","sap/base/Log"],function(e,t,n,r,a,i,o,s,d){"use strict";var l={resolveEventHandler:function(e,n){var r;e=e.trim();if(sap.ui.getCore().getConfiguration().getControllerCodeDeactivated()){r=function(){}}else{var a=e.indexOf("("),l=e;if(a>0){l=e.substring(0,a).trim()}else if(a===0){throw new Error("Event handler name starts with a bracket, must start with a function name "+"(or with a dot followed by controller-local function name): "+e)}switch(l.indexOf(".")){case 0:r=n&&s.get(l.slice(1),n);break;case-1:r=n&&n[l];if(r!=null){break}default:r=s.get(l)}if(r&&a>0){var f=e.lastIndexOf(")");if(f>a){if(e.substring(a).indexOf("{=")>-1){d.warning("It looks like an event handler parameter contains a binding expression ({=...}). This is not allowed and will cause an error later on "+"because the entire event handler is already considered an expression: "+e)}r=function(n,r){return function(a){var s,d,l=e;if(e.indexOf("$parameters")>-1){s=new i(a.mParameters)}if(e.indexOf("$source")>-1){d=new o(a.getSource())}var f={$controller:r,$event:a};if(n.indexOf(".")>0){var u=n.split(".")[0];f[u]=window[u]}else if(n.indexOf(".")===-1){if(r&&r[n]){l="$controller."+l}else if(window[n]){f[n]=window[n]}}var c=t.parseExpression(l.replace(/^\./,"$controller."),0,{oContext:r},f);if(c.result){try{p(c.result,a.getSource(),r,s,d)}catch(t){t.message="Error when evaluating event handler '"+e+"': "+t.message;throw t}}if(s){s.destroy()}if(d){d.destroy()}}}(l,n)}else{d.error("Syntax error in event handler '"+e+"': arguments must be enclosed in a pair of brackets")}}}if(typeof r==="function"){r._sapui_handlerName=e;return[r,n]}d.warning("Event handler name '"+e+"' could not be resolved to an event handler function")}};function p(e,t,n,i,o){var d;e.mode=r.OneWay;if(!e.parts){e.parts=[];e.parts[0]={path:e.path,targetType:e.targetType,type:e.type,suspended:e.suspended,formatOptions:e.formatOptions,constraints:e.constraints,model:e.model,mode:e.mode};delete e.path;delete e.targetType;delete e.mode;delete e.model}for(var l=0;l<e.parts.length;l++){var p=e.parts[l];if(typeof p=="string"){p={path:p};e.parts[l]=p}if(!p.path&&p.parts){throw new Error("Bindings in event handler parameters cannot use parts. Just use one single path.")}var f=p.path.indexOf(">");if(f>0){p.model=p.path.substr(0,f);p.path=p.path.substr(f+1)}}var u,c,m=[];e.parts.forEach(function(n){var a;if(n.model==="$parameters"){a=i;u=i.createBindingContext("/")}else if(n.model==="$source"){a=o;u=o.createBindingContext("/")}else{a=t.getModel(n.model);u=t.getBindingContext(n.model)}d=n.type;if(typeof d=="string"){g=s.get(d);if(typeof g!=="function"){throw new Error('Cannot find type "'+d+'" used for binding "'+n.path+'"!')}d=new g(n.formatOptions,n.constraints)}c=a.bindProperty(n.path,u,e.parameters);c.setType(d,n.targetType||"any");c.setFormatter(n.formatter);c.setBindingMode(r.OneTime);m.push(c)});if(m.length>1||e.formatter&&e.formatter.textFragments){d=e.type;if(typeof d=="string"){var g=s.get(d);d=new g(e.formatOptions,e.constraints)}c=new a(m,e.useRawValues,e.useInternalValues);c.setType(d,p.targetType||"any");c.setBindingMode(r.OneTime)}else{c=m[0]}c.setFormatter(e.formatter);c.initialize();return c.getExternalValue()}return l});