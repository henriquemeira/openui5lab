/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/Device","./NotificationListBase","sap/ui/core/InvisibleText","sap/ui/core/IconPool","sap/ui/core/ResizeHandler","sap/m/Button","./NotificationListItemRenderer"],function(e,t,i,s,r,a,o,n){"use strict";var p=e.ButtonType;var l=i.extend("sap.m.NotificationListItem",{metadata:{library:"sap.m",properties:{description:{type:"string",group:"Appearance",defaultValue:""},truncate:{type:"boolean",group:"Appearance",defaultValue:true},hideShowMoreButton:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{processingMessage:{type:"sap.m.MessageStrip",multiple:false},_bodyText:{type:"sap.m.Text",multiple:false,visibility:"hidden"}}}});l.prototype.init=function(){i.prototype.init.call(this);var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._expandText=e.getText("NOTIFICATION_LIST_ITEM_SHOW_MORE");this._collapseText=e.getText("NOTIFICATION_LIST_ITEM_SHOW_LESS");this._closeText=e.getText("NOTIFICATION_LIST_BASE_CLOSE");this.setType("Active");var t=new o(this.getId()+"-closeButton",{type:p.Transparent,icon:r.getIconURI("decline"),tooltip:this._closeText,press:function(){this.close()}.bind(this)});this.setAggregation("_closeButton",t,true);var a=new o({type:p.Transparent,text:this.getTruncate()?this._expandText:this._collapseText,id:this.getId()+"-expandCollapseButton",press:function(){this._deregisterResize();this.setProperty("truncate",!this.getTruncate(),true);a.setText(this.getTruncate()?this._expandText:this._collapseText);this.$().find(".sapMNLI-Header").toggleClass("sapMNLI-TitleWrapper--is-expanded");this.$().find(".sapMNLI-TextWrapper").toggleClass("sapMNLI-TextWrapper--is-expanded",this.getDescription());this._registerResize()}.bind(this)});this.setAggregation("_collapseButton",a,true);this._ariaDetailsText=new s({id:this.getId()+"-info"}).toStatic()};l.prototype.setDescription=function(e){var t=this.setProperty("description",e);this._getDescriptionText().setText(e);return t};l.prototype.setDatetime=function(e){var t=i.prototype.setDatetime.call(this,e);this._updateAriaAdditionalInfo();return t};l.prototype.setUnread=function(e){var t=this.setProperty("unread",e,true);var i=this.getAggregation("_headerTitle");if(i){i.toggleStyleClass("sapMNLI-Unread",this.getUnread())}return t};l.prototype.setPriority=function(e,t){var i=this.setProperty("priority",e,t);this._updateAriaAdditionalInfo();return i};l.prototype.setAuthorPicture=function(e,t){var i=this.setProperty("authorPicture",e,t);this._getAuthorImage().setSrc(e);return i};l.prototype.onBeforeRendering=function(){this._updateAriaAdditionalInfo();this._deregisterResize()};l.prototype.onAfterRendering=function(){this._registerResize()};l.prototype.onfocusin=function(e){if(!t.browser.msie){return}var i=e.target;if(i!==this.getDomRef()&&!i.classList.contains("sapMBtn")){e.preventDefault();e.stopImmediatePropagation();this.focus()}};l.prototype.exit=function(){this._deregisterResize();if(this._ariaDetailsText){this._ariaDetailsText.destroy();this._ariaDetailsText=null}};l.prototype._getDescriptionText=function(){var e=this.getAggregation("_bodyText");if(!e){e=new sap.m.Text({id:this.getId()+"-body",text:this.getDescription(),maxLines:2}).addStyleClass("sapMNLI-Text");this.setAggregation("_bodyText",e,true)}return e};l.prototype._activeHandling=function(){this.$().toggleClass("sapMNLIActive",this._active)};l.prototype._updateAriaAdditionalInfo=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");var t=this.getUnread()?e.getText("NOTIFICATION_LIST_ITEM_UNREAD"):e.getText("NOTIFICATION_LIST_ITEM_READ");var i=e.getText("NOTIFICATION_LIST_ITEM_DATETIME_PRIORITY",[this.getDatetime(),this.getPriority()]);var s=this.getAuthorName();var r=t+" ";if(s){r+=e.getText("NOTIFICATION_LIST_ITEM_CREATED_BY")+" "+this.getAuthorName()+" "}r+=i;this._ariaDetailsText.setText(r)};l.prototype._canTruncate=function(){var e=this.getDomRef("title").offsetHeight;var t=this.getDomRef("title").parentElement.offsetHeight;var i;var s;if(this._getDescriptionText().getText()){i=this.getDomRef("body").offsetHeight;s=this.getDomRef("body").parentElement.offsetHeight}return i>s||e>t};l.prototype._showHideTruncateButton=function(){var e=this.getDomRef(),t=sap.ui.getCore();if(!e){return}if(this._canTruncate()&&!this.getHideShowMoreButton()){this.getDomRef("expandCollapseButton").classList.remove("sapMNLI-CollapseButtonHide");if(this.getTruncate()){this.getAggregation("_collapseButton").setText(this._expandText);e.querySelector(".sapMNLI-Header").classList.remove("sapMNLI-TitleWrapper--is-expanded");if(this.getDescription()){e.querySelector(".sapMNLI-TextWrapper").classList.remove("sapMNLI-TextWrapper--is-expanded")}}else{this.getAggregation("_collapseButton").setText(this._collapseText);this.$().find(".sapMNLI-TextWrapper").toggleClass("sapMNLI-TextWrapper--is-expanded",this.getDescription());e.querySelector(".sapMNLI-Header").classList.add("sapMNLI-TitleWrapper--is-expanded")}}else{this.getDomRef("expandCollapseButton").classList.add("sapMNLI-CollapseButtonHide")}if(this.getDescription()){e.querySelector(".sapMNLI-TextWrapper").classList.remove("sapMNLI-TextWrapper--initial-overwrite")}if(this.getTitle()){e.querySelector(".sapMNLI-Header").classList.remove("sapMNLI-TitleWrapper--initial-overwrite")}t.detachThemeChanged(this._showHideTruncateButton,this)};l.prototype._deregisterResize=function(){if(this._sNotificationResizeHandler){a.deregister(this._sNotificationResizeHandler);this._sNotificationResizeHandler=null}};l.prototype._registerResize=function(){var e=this;var t=this.getDomRef();if(!t){return}e._resizeNotification();this._sNotificationResizeHandler=a.register(t,function(){e._resizeNotification()})};l.prototype._resizeNotification=function(){var e=this.getDomRef();var t=sap.ui.getCore();if(e.offsetWidth>=640){e.classList.add("sapMNLI-LSize")}else{e.classList.remove("sapMNLI-LSize")}if(this._getDescriptionText().getText()){e.querySelector(".sapMNLI-TextWrapper").classList.remove("sapMNLI-TextWrapper--is-expanded");e.querySelector(".sapMNLI-TextWrapper").classList.add("sapMNLI-TextWrapper--initial-overwrite")}e.querySelector(".sapMNLI-Header").classList.remove("sapMNLI-TitleWrapper--is-expanded");e.querySelector(".sapMNLI-Header").classList.add("sapMNLI-TitleWrapper--initial-overwrite");if(t.isThemeApplied()){this._showHideTruncateButton()}else{t.attachThemeChanged(this._showHideTruncateButton,this)}};return l});