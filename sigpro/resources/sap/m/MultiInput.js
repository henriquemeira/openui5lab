/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Input","./Tokenizer","./Token","./library","sap/ui/core/EnabledPropagator","sap/ui/base/ManagedObjectMetadata","sap/ui/Device","./Popover","./Button","./ToggleButton","./List","./Title","./Bar","./Toolbar","sap/ui/core/ResizeHandler","sap/ui/core/IconPool","./MultiInputRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/control"],function(e,t,i,o,n,s,r,a,l,p,h,u,g,c,d,_,f,k,y,v){"use strict";var T=o.PlacementType,m=o.ListMode;var S=e.extend("sap.m.MultiInput",{metadata:{library:"sap.m",designtime:"sap/m/designtime/MultiInput.designtime",properties:{enableMultiLineMode:{type:"boolean",group:"Behavior",defaultValue:false},maxTokens:{type:"int",group:"Behavior"}},aggregations:{tokens:{type:"sap.m.Token",multiple:true,singularName:"token"},tokenizer:{type:"sap.m.Tokenizer",multiple:false,visibility:"hidden"}},events:{tokenChange:{parameters:{type:{type:"string"},token:{type:"sap.m.Token"},tokens:{type:"sap.m.Token[]"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},tokenUpdate:{allowPreventDefault:true,parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}}}}});n.apply(S.prototype,[true]);var I=sap.ui.getCore().getLibraryResourceBundle("sap.m");S.prototype.init=function(){this._bShowListWithTokens=false;e.prototype.init.call(this);this._bIsValidating=false;this._tokenizer=new t;this._tokenizer._setAdjustable(true);this.setAggregation("tokenizer",this._tokenizer);this._tokenizer.attachTokenChange(this._onTokenChange,this);this._tokenizer.attachTokenUpdate(this._onTokenUpdate,this);this._tokenizer._handleNMoreIndicatorPress(this._handleIndicatorPress.bind(this));this._tokenizer.addEventDelegate({onThemeChanged:this._handleInnerVisibility.bind(this)},this);this.setShowValueHelp(true);this.setShowSuggestion(true);this.attachSuggestionItemSelected(this._onSuggestionItemSelected,this);this.attachLiveChange(this._onLiveChange,this);this.attachValueHelpRequest(function(){this._bValueHelpOpen=true},this);this._getValueHelpIcon().setProperty("visible",true,true);this._modifySuggestionPicker()};S.prototype.exit=function(){e.prototype.exit.call(this);if(this._oSelectedItemPicker){this._oSelectedItemPicker.destroy();this._oSelectedItemPicker=null}if(this._oSelectedItemsList){this._oSelectedItemsList.destroy();this._oSelectedItemsList=null}if(this._getReadOnlyPopover()){var t=this._getReadOnlyPopover();t.destroy();t=null}this._deregisterResizeHandler()};S.prototype.onAfterRendering=function(){this._tokenizer.scrollToEnd();this._registerResizeHandler();this._tokenizer.setMaxWidth(this._calculateSpaceForTokenizer());this._handleInnerVisibility();e.prototype.onAfterRendering.apply(this,arguments)};S.prototype._handleInnerVisibility=function(){if(this._oReadOnlyPopover&&!this.getEditable()){var e=this._tokenizer._hasMoreIndicator();this[e?"_setValueInvisible":"_setValueVisible"].call(this)}};S.prototype.oninput=function(t){e.prototype.oninput.call(this,t);this._manageListsVisibility(false);this._getSelectedItemsPicker().close()};S.prototype._registerResizeHandler=function(){if(!this._iResizeHandlerId){this._iResizeHandlerId=d.register(this,this._onResize.bind(this))}};S.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){d.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null}};S.prototype._onResize=function(){this._tokenizer.setMaxWidth(this._calculateSpaceForTokenizer());this._handleInnerVisibility()};S.prototype._onTokenChange=function(e){this.fireTokenChange(e.getParameters());this.invalidate();var t=k(this.getDomRef(),document.activeElement);if(e.getParameter("type")==="tokensChanged"&&e.getParameter("removedTokens").length>0&&t){this.focus()}if(e.getParameter("type")==="removed"){this._tokenizer._useCollapsedMode(false);this.focus()}};S.prototype._onTokenUpdate=function(e){var t=this.fireTokenUpdate(e.getParameters());if(!t){e.preventDefault()}else{this.invalidate()}if(this._bUseDialog){this._fillList();this._manageListsVisibility(true)}};S.prototype._onSuggestionItemSelected=function(e){var t=null,o=null,n=this,s=this._tokenizer.getTokens().length;if(this.getMaxTokens()&&s>=this.getMaxTokens()||this._bValueHelpOpen){return}if(this._hasTabularSuggestions()){t=e.getParameter("selectedRow")}else{t=e.getParameter("selectedItem");if(t){o=new i({text:t.getText(),key:t.getKey()})}}if(t){var r=this.getValue();this._tokenizer._addValidateToken({text:r,token:o,suggestionObject:t,validationCallback:function(e){if(e){n.setValue("")}}})}if(this._bUseDialog){var a=this._tokenizer.getTokens().length;if(s<a){this.setValue("")}if(this._getSuggestionsList()instanceof sap.m.Table){this._getSuggestionsList().addStyleClass("sapMInputSuggestionTableHidden")}else{this._getSuggestionsList().destroyItems()}var l=this._oSuggestionPopup.getScrollDelegate();if(l){l.scrollTo(0,0,0)}this._oSuggPopover._oPopupInput.focus()}};S.prototype._onLiveChange=function(e){this._tokenizer._removeSelectedTokens()};S.prototype._setValueInvisible=function(){this.$("inner").css("opacity","0")};S.prototype._setValueVisible=function(){this.$("inner").css("opacity","1")};S.prototype._calculateSpaceForTokenizer=function(){if(this.getDomRef()){var e=this.getDomRef().offsetWidth,t=this.getDomRef("vhi")?parseInt(this.getDomRef("vhi").offsetWidth):0,i=parseInt(this.$().find(".sapMInputBaseInner").css("min-width"))||0;return e-(t+i)+"px"}else{return null}};S.prototype.setEnableMultiLineMode=function(e){return this.setProperty("enableMultiLineMode",e,true)};S.prototype.onmousedown=function(e){if(e.target==this.getDomRef("content")){e.preventDefault();e.stopPropagation()}};S.prototype._openMultiLineOnDesktop=function(){};S.prototype.openMultiLine=function(){};S.prototype.closeMultiLine=function(){};S.prototype.getScrollDelegate=function(){return this._tokenizer._oScroller};S.prototype.onBeforeRendering=function(){var t=this.getAggregation("tokenizer");if(t){t.toggleStyleClass("sapMTokenizerEmpty",t.getTokens().length===0)}e.prototype.onBeforeRendering.apply(this,arguments);this._deregisterResizeHandler()};S.prototype.addValidator=function(e){this._tokenizer.addValidator(e)};S.prototype.removeValidator=function(e){this._tokenizer.removeValidator(e)};S.prototype.removeAllValidators=function(){this._tokenizer.removeAllValidators()};S.prototype.onsapnext=function(e){if(e.isMarked()){return}var t=v(document.activeElement).control()[0];if(!t){return}if(this._tokenizer===t||this._tokenizer.$().find(t.$()).length>0){this._scrollAndFocus()}};S.prototype.onsapbackspace=function(e){if(this.getCursorPosition()>0||!this.getEditable()||this.getValue().length>0){return}t.prototype.onsapbackspace.apply(this._tokenizer,arguments);e.preventDefault();e.stopPropagation()};S.prototype.onsapdelete=function(e){if(!this.getEditable()){return}if(this.getValue()&&!this._completeTextIsSelected()){return}t.prototype.onsapdelete.apply(this._tokenizer,arguments)};S.prototype.onkeydown=function(e){if(e.which===y.TAB){this._tokenizer._changeAllTokensSelection(false)}if((e.ctrlKey||e.metaKey)&&e.which===y.A){if(this._tokenizer.getTokens().length>0){this._tokenizer.focus();this._tokenizer._changeAllTokensSelection(true);e.preventDefault()}}if((e.ctrlKey||e.metaKey)&&(e.which===y.C||e.which===y.INSERT)){this._tokenizer._copy()}if((e.ctrlKey||e.metaKey)&&e.which===y.X||e.shiftKey&&e.which===y.DELETE){if(this.getEditable()){this._tokenizer._cut()}else{this._tokenizer._copy()}}};S.prototype.onpaste=function(e){var i,o,n=[],s=[];if(this.getValueHelpOnly()){return}if(window.clipboardData){i=window.clipboardData.getData("Text")}else{i=e.originalEvent.clipboardData.getData("text/plain")}var r=this._tokenizer._parseString(i);if(r.length<=1){return}setTimeout(function(){if(r){if(this.fireEvent("_validateOnPaste",{texts:r},true)){var e="";for(o=0;o<r.length;o++){if(r[o]){var i=this._convertTextToToken(r[o],true);if(i){n.push(i)}else{e=r[o]}}}this.updateDomValue(e);for(o=0;o<n.length;o++){if(this._tokenizer._addUniqueToken(n[o])){s.push(n[o])}}if(s.length>0){this.fireTokenUpdate({addedTokens:s,removedTokens:[],type:t.TokenUpdateType.Added})}}if(s.length){this.cancelPendingSuggest()}}}.bind(this),0)};S.prototype._convertTextToToken=function(e,t){var o=null,n=null,s=null,r=this._tokenizer.getTokens().length;if(!this.getEditable()){return null}e=e.trim();if(!e){return null}if(this._getIsSuggestionPopupOpen()||t){if(this._hasTabularSuggestions()){n=this._oSuggestionTable._oSelectedItem}else{n=this._getSuggestionItem(e)}}if(n&&n.getText&&n.getKey){s=new i({text:n.getText(),key:n.getKey()})}var a=this;o=this._tokenizer._validateToken({text:e,token:s,suggestionObject:n,validationCallback:function(e){a._bIsValidating=false;if(e){a.setValue("");if(a._bUseDialog&&a._isMultiLineMode&&a._oSuggestionTable.getItems().length===0){var t=a._tokenizer.getTokens().length;if(r<t){a._oSuggPopover._oPopupInput.setValue("")}a._setAllTokenVisible()}}}});return o};S.prototype.onsapprevious=function(e){if(this._getIsSuggestionPopupOpen()){return}if(this.getCursorPosition()===0){if(e.srcControl===this){t.prototype.onsapprevious.apply(this._tokenizer,arguments);e.preventDefault()}}};S.prototype._scrollAndFocus=function(){this._tokenizer.scrollToEnd();this.$().find("input").focus()};S.prototype.onsaphome=function(e){if(this._tokenizer._checkFocus()){t.prototype.onsaphome.apply(this._tokenizer,arguments)}};S.prototype.onsapend=function(e){if(this._tokenizer._checkFocus()){t.prototype.onsapend.apply(this._tokenizer,arguments);e.preventDefault()}};S.prototype.onsapenter=function(t){if(e.prototype.onsapenter){e.prototype.onsapenter.apply(this,arguments)}var i=true;if(this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){if(this._hasTabularSuggestions()){i=!this._oSuggestionTable.getSelectedItem()}else{i=!this._getSuggestionsList().getSelectedItem()}}if(i){this._validateCurrentText()}this.focus()};S.prototype._checkFocus=function(){return this.getDomRef()&&k(this.getDomRef(),document.activeElement)};S.prototype.onsapfocusleave=function(t){var i=this._oSuggestionPopup,o=this._oSelectedItemPicker,n=false,s=false,r=this._checkFocus(),a,l;if(i instanceof sap.m.Popover){if(t.relatedControlId){a=sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef();n=k(i.getFocusDomRef(),a);s=k(this._tokenizer.getFocusDomRef(),a);if(o){l=k(o.getFocusDomRef(),a)}}}if(!s&&!n){this._tokenizer.scrollToEnd()}e.prototype.onsapfocusleave.apply(this,arguments);if(this._bIsValidating||this._bValueHelpOpen){return}if(!this._bUseDialog&&!n&&t.relatedControlId!==this.getId()&&t.relatedControlId!==this._tokenizer.getId()){this._validateCurrentText(true)}if(!this._bUseDialog&&this.getEditable()){if(r||n){return}}if(!l&&!s){this._tokenizer._useCollapsedMode(true);this._tokenizer._getIndicatorVisibility()&&this._setValueInvisible()}if(this._oReadOnlyPopover&&this._oReadOnlyPopover.isOpen()&&!s){this._oReadOnlyPopover.close()}};S.prototype._onDialogClose=function(){this._validateCurrentText();this.setAggregation("tokenizer",this._tokenizer);this._tokenizer.setReverseTokens(false);this._tokenizer.invalidate()};S.prototype.ontap=function(t){if(document.activeElement===this._$input[0]||document.activeElement===this._tokenizer.getDomRef()){this._tokenizer.selectAllTokens(false)}if(t&&t.isMarked("tokenDeletePress")){return}e.prototype.ontap.apply(this,arguments)};S.prototype._onclick=function(e){};S.prototype.onfocusin=function(t){this._bValueHelpOpen=false;if(t.target===this.getFocusDomRef()){e.prototype.onfocusin.apply(this,arguments)}if(this.getEditable()&&(!t.target.classList.contains("sapMInputValHelp")&&!t.target.classList.contains("sapMInputValHelpInner"))){if(this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){return}this._tokenizer._useCollapsedMode(false);this._setValueVisible();this._tokenizer.scrollToEnd()}};S.prototype.onsapescape=function(t){this._tokenizer.selectAllTokens(false);this.selectText(0,0);e.prototype.onsapescape.apply(this,arguments)};S.prototype._validateCurrentText=function(e){var t=this.getValue();if(!t||!this.getEditable()){return}t=t.trim();if(!t){return}var o=null;if(e||this._getIsSuggestionPopupOpen()){if(this._hasTabularSuggestions()){o=this._oSuggestionTable._oSelectedItem}else{o=this._getSuggestionItem(t,e)}}var n=null;if(o&&o.getText&&o.getKey){n=new i({text:o.getText(),key:o.getKey()})}var s=this;if(!this.getMaxTokens()||this.getTokens().length<this.getMaxTokens()){this._bIsValidating=true;this._tokenizer._addValidateToken({text:t,token:n,suggestionObject:o,validationCallback:function(e){s._bIsValidating=false;if(e){s.setValue("")}}})}};S.prototype.getCursorPosition=function(){return this._$input.cursorPos()};S.prototype._completeTextIsSelected=function(){var e=this._$input[0];if(e.selectionStart!==0){return false}if(e.selectionEnd!==this.getValue().length){return false}return true};S.prototype._getIsSuggestionPopupOpen=function(){return this._oSuggPopover&&this._oSuggPopover._oPopover.isOpen()};S.prototype.setEditable=function(t){t=this.validateProperty("editable",t);var i=this._getTokensList();if(t===this.getEditable()){return this}if(e.prototype.setEditable){e.prototype.setEditable.apply(this,arguments)}this._tokenizer.setEditable(t);if(t){if(this._bUseDialog){this._oSuggPopover._oPopover.addContent(i)}else{this._getSelectedItemsPicker().addContent(i)}i.setMode(m.MultiSelect)}else{i.setMode(m.None);this._getReadOnlyPopover().addContent(i)}return this};S.prototype._findItem=function(e,t,i,o){if(!e){return}if(!(t&&t.length)){return}e=e.toLowerCase();var n=t.length;for(var s=0;s<n;s++){var r=t[s];var a=o(r);if(!a){continue}a=a.toLowerCase();if(a===e){return r}if(!i&&a.indexOf(e)===0){return r}}};S.prototype._getSuggestionItem=function(e,t){var i=null;var o=null;if(this._hasTabularSuggestions()){i=this.getSuggestionRows();o=this._findItem(e,i,t,function(e){var t=e.getCells();var i=null;if(t){var o;for(o=0;o<t.length;o++){if(t[o].getText){i=t[o].getText();break}}}return i})}else{i=this.getSuggestionItems();o=this._findItem(e,i,t,function(e){return e.getText()})}return o};S.getMetadata().forwardAggregation("tokens",{getter:function(){return this._tokenizer},aggregation:"tokens",forwardBinding:true});S.prototype.clone=function(){var t,i;this.detachSuggestionItemSelected(this._onSuggestionItemSelected,this);this.detachLiveChange(this._onLiveChange,this);this._tokenizer.detachTokenChange(this._onTokenChange,this);this._tokenizer.detachTokenUpdate(this._onTokenUpdate,this);t=e.prototype.clone.apply(this,arguments);t.destroyAggregation("tokenizer");t._tokenizer=null;i=this._tokenizer.clone();t._tokenizer=i;t.setAggregation("tokenizer",i,true);this._tokenizer.attachTokenChange(this._onTokenChange,this);this._tokenizer.attachTokenUpdate(this._onTokenUpdate,this);t._tokenizer.attachTokenChange(t._onTokenChange,t);t._tokenizer.attachTokenUpdate(t._onTokenUpdate,t);t._tokenizer._handleNMoreIndicatorPress(t._handleIndicatorPress.bind(t));this.attachSuggestionItemSelected(this._onSuggestionItemSelected,this);this.attachLiveChange(this._onLiveChange,this);return t};S.prototype.getPopupAnchorDomRef=function(){return this.getDomRef("content")};S.prototype.setTokens=function(e){var t,i=[],o;if(Array.isArray(e)){for(o=0;o<e.length;o++){t=this.validateAggregation("tokens",e[o],true);s.addAPIParentInfoBegin(e[o],this,"tokens");i.push(t)}this._tokenizer.setTokens(i);for(o=0;o<e.length;o++){s.addAPIParentInfoEnd(e[o])}}else{throw new Error('"'+e+'" is of type '+typeof e+", expected array for aggregation tokens of "+this)}return this};S.TokenChangeType={Added:"added",Removed:"removed",RemovedAll:"removedAll",TokensChanged:"tokensChanged"};S.WaitForAsyncValidation="sap.m.Tokenizer.WaitForAsyncValidation";S.prototype.getDomRefForValueStateMessage=S.prototype.getPopupAnchorDomRef;S.prototype.updateInputField=function(t){e.prototype.updateInputField.call(this,t);this.setDOMValue("")};S.prototype.getAccessibilityInfo=function(){var t=this.getTokens().map(function(e){return e.getText()}).join(" ");var i=e.prototype.getAccessibilityInfo.apply(this,arguments);i.type=I.getText("ACC_CTR_TYPE_MULTIINPUT");i.description=((i.description||"")+" "+t).trim();return i};S.prototype._modifySuggestionPicker=function(){var e=this;if(!this._bUseDialog){return}this._bShowSelectedButton=this._createFilterSelectedButton();this._oSuggPopover._oPopover.addContent(this._getTokensList());this._oSuggPopover._oPopover.attachBeforeOpen(function(){e._manageListsVisibility(e._bShowListWithTokens);e._fillList();e._updatePickerHeaderTitle()}).attachAfterClose(function(){e._tokenizer._useCollapsedMode(true);e._bShowListWithTokens=false});this._oSuggPopover._oPopover.setCustomHeader(new g({contentMiddle:[new u],contentRight:new l({icon:_.getIconURI("decline"),press:function(){e._oSuggPopover._oPopover.close()}})}));this._oSuggPopover._oPopover.setSubHeader(new c({content:[this._oSuggPopover._oPopupInput,this._bShowSelectedButton]}));this._oSuggPopover._oPopupInput.onsapenter=function(t){e._validateCurrentText();e._setValueInvisible();e.onChange(t,null,this.getValue())};this._oSuggPopover._oPopupInput.attachLiveChange(function(){if(e._bShowListWithTokens){e._filterTokens(this.getValue())}e._manageListsVisibility(e._bShowListWithTokens)})};S.prototype._createFilterSelectedButton=function(){var e=_.getIconURI("multiselect-all"),t=this;return new p({icon:e,press:function(e){t._bShowListWithTokens=e.getSource().getPressed();t._manageListsVisibility(t._bShowListWithTokens)}})};S.prototype._onBeforeOpenTokensPicker=function(){var e=this._getSelectedItemsPicker(),t=this.getDomRef(),i;this._setValueInvisible();this._fillList();if(t&&e){i=t.offsetWidth/parseFloat(o.BaseFontSize)+"rem";e.setContentMinWidth(i)}};S.prototype._onAfterCloseTokensPicker=function(){if(this._oSuggPopover&&!this.getValue()){this._tokenizer._useCollapsedMode(true);this._setValueInvisible()}};S.prototype.getDialogTitle=function(){var e=this._oSuggPopover._oPopover,t=e&&e.getCustomHeader();if(t){return t.getContentMiddle()[0]}return null};S.prototype._updatePickerHeaderTitle=function(){var e,t;t=this.getLabels();if(t.length){e=t[0];if(e&&typeof e.getText==="function"){this.getDialogTitle().setText(e.getText())}}else{this.getDialogTitle().setText(I.getText("COMBOBOX_PICKER_TITLE"))}};S.prototype._openSelectedItemsPicker=function(){if(this._bUseDialog){this._oSuggPopover._oPopover.open()}else{var e=this._getSelectedItemsPicker();if(e){e.open()}}this._manageListsVisibility(true);this._setValueVisible();return this};S.prototype._getTokensList=function(){if(!this._oSelectedItemsList){this._oSelectedItemsList=this._createTokensList()}return this._oSelectedItemsList};S.prototype._getSuggestionsList=function(){return this._oSuggPopover&&this._oSuggPopover._oList};S.prototype._createTokensList=function(){return new h({width:"auto",mode:m.MultiSelect,includeItemInSelection:true,rememberSelections:false}).attachBrowserEvent("tap",this._handleItemTap,this).attachSelectionChange(this._handleSelectionLiveChange,this)};S.prototype._filterTokens=function(e){this._getTokensList().getItems().forEach(function(t){if(t.getTitle().toLowerCase().indexOf(e)>-1){t.setVisible(true)}else{t.setVisible(false)}})};S.prototype._manageListsVisibility=function(e){this._getTokensList().setVisible(e);this._getSuggestionsList()&&this._getSuggestionsList().setVisible(!e);if(this._bUseDialog){this._bShowSelectedButton.setPressed(e)}};S.prototype._mapTokenToListItem=function(e){if(!e){return null}var t=new sap.m.StandardListItem({selected:true,title:e.getText()});t.data("key",e.getKey());t.data("text",e.getText());t.data("tokenId",e.getId());return t};S.prototype._fillList=function(){var e=this.getTokens(),t;if(!e){return}this._getTokensList().removeAllItems();for(var i=0,o=e.length;i<o;i++){var n=e[i],t=this._mapTokenToListItem(n);this._getTokensList().addItem(t)}};S.prototype._handleIndicatorPress=function(){this._bShowListWithTokens=true;if(this.getEditable()){this._openSelectedItemsPicker()}else{this._fillList();this._getReadOnlyPopover().openBy(this._tokenizer._oIndicator[0])}};S.prototype._handleItemTap=function(e){if(v(e.target).hasClass("sapMCbMark")){return}if(this._bUseDialog){this._oSuggPopover._oPopover.close()}else if(this._oReadOnlyPopover&&this._oReadOnlyPopover.isOpen()){this._oReadOnlyPopover.close()}else{this._getSelectedItemsPicker().close()}};S.prototype._handleSelectionLiveChange=function(e){var t=e.getParameter("listItem"),i=e.getParameter("selected");this._syncTokensWithSelection(t,i)};S.prototype._syncTokensWithSelection=function(e,t){if(t){var o=new i({text:e.data("text"),key:e.data("key")});e.data("tokenId",o.getId());this.addToken(o)}else{var n=e.data("tokenId");this.getTokens().some(function(e){if(e.getId()===n){this._tokenizer._onTokenDelete(e);return true}}.bind(this))}};S.prototype._getSelectedItemsPicker=function(){if(this._oSelectedItemPicker){return this._oSelectedItemPicker}this._oSelectedItemPicker=this._createDropdown();if(!this._bUseDialog){this._oSelectedItemPicker.setHorizontalScrolling(false).attachBeforeOpen(this._onBeforeOpenTokensPicker,this).attachAfterClose(this._onAfterCloseTokensPicker,this).addContent(this._getTokensList())}return this._oSelectedItemPicker};S.prototype._createDropdown=function(){var e=new a(this._getDropdownSettings());e.setInitialFocus(this);this._decoratePopover(e);return e};S.prototype._getReadOnlyPopover=function(){if(!this._oReadOnlyPopover){this._oReadOnlyPopover=this._createReadOnlyPopover()}return this._oReadOnlyPopover};S.prototype._createReadOnlyPopover=function(){return new a({showArrow:true,placement:T.Auto,showHeader:false,contentMinWidth:"auto"}).addStyleClass("sapMMultiInputReadOnlyPopover").setInitialFocus(this)};S.prototype._decoratePopover=function(e){var t=this;e.open=function(){return this.openBy(t)}};S.prototype._getDropdownSettings=function(){return{showArrow:false,showHeader:false,placement:T.VerticalPreferredBottom,offsetX:0,offsetY:0,bounce:false}};return S});